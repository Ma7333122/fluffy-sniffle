<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù… - Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø¨Ø³Ù‡ÙˆÙ„Ø©">
  <meta name="theme-color" content="#3498db">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ±">
  <link rel="manifest" href="data:application/json,{&quot;name&quot;:&quot;Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…&quot;,&quot;short_name&quot;:&quot;Ø§Ù„ÙÙˆØ§ØªÙŠØ±&quot;,&quot;start_url&quot;:&quot;.&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;#ffffff&quot;,&quot;theme_color&quot;:&quot;#3498db&quot;,&quot;icons&quot;:[{&quot;src&quot;:&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==&quot;,&quot;sizes&quot;:&quot;192x192&quot;,&quot;type&quot;:&quot;image/png&quot;}]}">
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</title>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --accent: #e74c3c;
      --light: #ecf0f1;
      --dark: #2c3e50;
      --success: #27ae60;
      --warning: #f39c12;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --bg-color: #ffffff;
      --text-color: #2c3e50;
      --card-bg: #ffffff;
      --border-color: #ddd;
    }
    
    /* ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ù„ÙŠÙ„ÙŠØ© */
    body.dark-mode {
      --bg-color: #1a1a1a;
      --text-color: #e0e0e0;
      --card-bg: #2d2d2d;
      --border-color: #444;
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      color: var(--text-color);
    }
    
    body.dark-mode header {
      background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
      border-color: #444;
    }
    
    body.dark-mode .tab-content,
    body.dark-mode .invoice-preview {
      background: var(--card-bg);
      color: var(--text-color);
    }
    
    body.dark-mode input,
    body.dark-mode select,
    body.dark-mode textarea {
      background: #1a1a1a;
      color: var(--text-color);
      border-color: var(--border-color);
    }
    
    body.dark-mode table {
      background: var(--card-bg);
    }
    
    body.dark-mode th {
      background-color: var(--primary);
    }
    
    body.dark-mode tr:nth-child(even) {
      background-color: #333;
    }
    
    body.dark-mode .totals-section {
      background: #333;
      color: var(--text-color);
    }
    
    body.dark-mode .section {
      border-bottom-color: var(--border-color);
    }
    
    body.dark-mode .notification {
      color: white;
    }
    
    body.dark-mode .developer-contact {
      background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
    }
    
    body.dark-mode #qrCustomSection {
      background: #333;
      border-color: #555;
    }
    
    body.dark-mode #qrCustomSection p {
      color: #ccc;
    }
    
    body.dark-mode #quickAddModal > div {
      background: var(--card-bg);
      color: var(--text-color);
    }
    
    body.dark-mode #quickAddModal input {
      background: #1a1a1a;
      color: var(--text-color);
      border-color: var(--border-color);
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ© */
    .btn, .quick-action-btn {
      transition: all 0.3s ease;
    }
    
    .btn:active, .quick-action-btn:active {
      transform: translateY(0) scale(0.98);
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ù„Ù‰ Ù‚Ø³Ù… QR Code */
    #qrCustomSection {
      transition: all 0.3s ease;
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù„ÙˆØ¬Ùˆ */
    .logo-preview {
      transition: all 0.3s ease;
    }
    
    .logo-preview:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ù„Ù‰ Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
    .image-saving {
      backdrop-filter: blur(5px);
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 0.9;
      }
      50% {
        opacity: 1;
      }
    }
    
    #imageProgress {
      font-weight: 600;
      color: var(--secondary) !important;
      font-size: 1.1rem;
      animation: bounce 1s infinite;
    }
    
    @keyframes bounce {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-5px);
      }
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      direction: rtl;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: var(--dark);
      line-height: 1.6;
      padding: 15px;
      min-height: 100vh;
      transition: background 0.3s ease, color 0.3s ease;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ */
    * {
      -webkit-tap-highlight-color: transparent;
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¯Ù‚Ø© */
    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
      body {
        -webkit-font-smoothing: antialiased;
      }
    }
    
    /* Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
    .theme-toggle {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 2000;
      background: var(--secondary);
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      box-shadow: var(--shadow);
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }
    
    .theme-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
    }
    
    /* Ù‚Ø³Ù… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø·ÙˆØ± */
    .developer-contact {
      background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
      color: white;
      padding: 25px;
      border-radius: 15px;
      margin-top: 30px;
      text-align: center;
      box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .developer-contact::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: rotate 20s linear infinite;
    }
    
    @keyframes rotate {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }
    
    .developer-contact:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 35px rgba(52, 152, 219, 0.4);
    }
    
    .developer-contact > * {
      position: relative;
      z-index: 1;
    }
    
    .developer-contact h3 {
      margin-bottom: 15px;
      font-size: 1.2rem;
    }
    
    .developer-contact p {
      margin: 8px 0;
      font-size: 0.95rem;
    }
    
    .whatsapp-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #25D366;
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: 600;
      margin-top: 15px;
      transition: all 0.3s;
      box-shadow: 0 4px 6px rgba(37, 211, 102, 0.3);
    }
    
    .whatsapp-btn:hover {
      background: #20BA5A;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(37, 211, 102, 0.4);
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù„ÙˆØ¬Ùˆ */
    .logo-upload-container {
      margin-bottom: 15px;
    }
    
    .logo-preview {
      max-width: 150px;
      max-height: 150px;
      margin-top: 10px;
      border: 2px dashed var(--border-color);
      border-radius: 8px;
      padding: 10px;
      display: none;
    }
    
    .logo-preview img {
      max-width: 100%;
      height: auto;
      border-radius: 4px;
    }
    
    /* QR Code ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ø£Ø¹Ù„Ù‰ */
    .qr-code-top {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }
    
    body.dark-mode .qr-code-top {
      background: #333;
      border-color: #555;
    }
    
    .qr-code-top-center {
      text-align: center;
    }
    
    .qr-code-top-center img {
      max-width: 150px;
      height: auto;
      border: 2px solid var(--border-color);
      padding: 8px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    body.dark-mode .qr-code-top-center img {
      background: #1a1a1a;
      border-color: #555;
    }
    
    /* Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙÙŠ Ø±Ø£Ø³ Ø§Ù„ÙØ§ØªÙˆØ±Ø© */
    .company-logo-header {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .company-logo-preview {
      max-width: 150px;
      max-height: 150px;
      border-radius: 8px;
      border: 2px solid var(--border-color);
      padding: 8px;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin: 0 auto;
      display: block;
    }
    
    body.dark-mode .company-logo-preview {
      background: #1a1a1a;
      border-color: #555;
    }
    
    /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ù†ØµÙŠ Ù…Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø© */
    .invoice-preview #companyLogoTextContainer,
    .invoice-preview #previewCompanyLogo {
      display: none !important;
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø© */
    .invoice-preview {
      position: relative;
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ù„Ù‰ QR Code */
    .qr-code-top-center img {
      transition: all 0.3s ease;
    }
    
    .qr-code-top-center img:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø±ÙƒØ§Øª */
    .company-badge {
      display: inline-block;
      padding: 5px 14px;
      background: linear-gradient(135deg, var(--secondary) 0%, #2980b9 100%);
      color: white;
      border-radius: 15px;
      font-size: 0.8rem;
      font-weight: 700;
      margin-right: 10px;
      box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
      animation: pulse-badge 2s infinite;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    @keyframes pulse-badge {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      animation: fadeIn 0.5s ease-in;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    header {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
      margin-bottom: 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      border: 2px solid rgba(52, 152, 219, 0.15);
      transition: all 0.3s ease;
    }
    
    header:hover {
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      transform: translateY(-2px);
    }
    
    .tab-content {
      background: var(--card-bg);
      transition: all 0.3s ease;
    }
    
    .invoice-preview {
      background: var(--card-bg);
      transition: all 0.3s ease;
    }
    
    .logo-section {
      display: flex;
      align-items: center;
    }
    
    .logo {
      width: 70px;
      height: 70px;
      background: linear-gradient(135deg, var(--secondary) 0%, #2980b9 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 24px;
      margin-left: 15px;
      box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .logo:hover {
      transform: scale(1.1) rotate(5deg);
      box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
    }
    
    .company-info {
      flex-grow: 1;
    }
    
    .company-info h1 {
      color: var(--primary);
      margin-bottom: 5px;
      border: 2px dashed transparent;
      padding: 6px 8px;
      border-radius: 6px;
      font-size: 1.5rem;
      font-weight: 700;
      transition: all 0.3s ease;
      min-height: 35px;
    }
    
    .company-info h1:focus {
      border-color: var(--secondary);
      outline: none;
      background: rgba(52, 152, 219, 0.05);
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }
    
    .company-info h1:hover {
      border-color: rgba(52, 152, 219, 0.3);
    }
    
    .company-info p {
      color: #666;
      border: 2px dashed transparent;
      padding: 4px 6px;
      border-radius: 4px;
      margin-bottom: 3px;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      min-height: 25px;
    }
    
    .company-info p:focus {
      border-color: var(--secondary);
      outline: none;
      background: rgba(52, 152, 219, 0.05);
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
    }
    
    .company-info p:hover {
      border-color: rgba(52, 152, 219, 0.3);
    }
    
    .invoice-header {
      text-align: left;
    }
    
    .invoice-header h2 {
      color: var(--primary);
      margin-bottom: 8px;
      font-size: 1.3rem;
    }
    
    .tabs {
      display: flex;
      background: white;
      border-radius: 12px 12px 0 0;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(52, 152, 219, 0.1);
      border-bottom: none;
    }
    
    .tab {
      padding: 14px 20px;
      cursor: pointer;
      background: #f8f9fa;
      border: none;
      flex: 1;
      text-align: center;
      font-weight: 600;
      transition: all 0.3s ease;
      font-size: 0.95rem;
      position: relative;
    }
    
    .tab.active {
      background: linear-gradient(135deg, var(--secondary) 0%, #2980b9 100%);
      color: white;
      box-shadow: inset 0 -3px 10px rgba(0,0,0,0.1);
    }
    
    .tab:hover:not(.active) {
      background: #e9ecef;
      transform: translateY(-2px);
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: white;
    }
    
    .tab-content {
      display: none;
      background: white;
      padding: 25px;
      border-radius: 0 0 12px 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      border: 1px solid rgba(52, 152, 219, 0.1);
      border-top: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .section {
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 2px solid #eee;
      transition: all 0.3s ease;
    }
    
    .section:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }
    
    .section:hover {
      background: rgba(52, 152, 219, 0.02);
      border-radius: 8px;
      padding: 15px;
      margin: 15px -15px 25px -15px;
    }
    
    .section-title {
      color: var(--primary);
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 3px solid var(--secondary);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1.2rem;
      font-weight: 600;
    }
    
    .form-group {
      margin-bottom: 15px;
      position: relative;
      transition: all 0.3s ease;
    }
    
    .form-group.focused {
      transform: translateX(-5px);
    }
    
    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #555;
      font-size: 0.95rem;
      transition: color 0.3s ease;
    }
    
    .form-group.focused label {
      color: var(--secondary);
    }
    
    input[type="text"],
    input[type="number"],
    input[type="date"],
    input[type="email"],
    select,
    textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      background: white;
    }
    
    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--secondary);
      outline: none;
      box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.15);
      transform: translateY(-1px);
      background: #fafbfc;
    }
    
    input:hover,
    select:hover,
    textarea:hover {
      border-color: rgba(52, 152, 219, 0.5);
    }
    
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-top: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      border-radius: 10px;
      overflow: hidden;
      border: 2px solid var(--secondary);
    }
    
    th, td {
      border: 1px solid rgba(52, 152, 219, 0.2);
      padding: 12px 8px;
      text-align: center;
      font-size: 0.9rem;
    }
    
    th {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.85rem;
      letter-spacing: 0.5px;
    }
    
    tr:nth-child(even) {
      background-color: #f8f9fa;
    }
    
    tr:hover {
      background-color: rgba(52, 152, 219, 0.1);
      transform: scale(1.01);
      transition: all 0.2s ease;
    }
    
    tr:first-child th:first-child {
      border-top-right-radius: 8px;
    }
    
    tr:first-child th:last-child {
      border-top-left-radius: 8px;
    }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    
    .btn-primary {
      background: var(--secondary);
      color: white;
    }
    
    .btn-primary:hover {
      background: #2980b9;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .btn-success {
      background: var(--success);
      color: white;
    }
    
    .btn-success:hover {
      background: #219653;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .btn-danger {
      background: var(--accent);
      color: white;
    }
    
    .btn-danger:hover {
      background: #c0392b;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .btn-info {
      background: #17a2b8;
      color: white;
    }
    
    .btn-info:hover {
      background: #138496;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid var(--secondary);
      color: var(--secondary);
    }
    
    .btn-outline:hover {
      background: var(--secondary);
      color: white;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .action-buttons .btn {
      min-width: 140px;
      position: relative;
      overflow: hidden;
    }
    
    .action-buttons .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .action-buttons .btn:hover::before {
      width: 300px;
      height: 300px;
    }
    
    .totals-section {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
      border: 2px solid var(--secondary);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .total-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 2px solid rgba(52, 152, 219, 0.2);
      font-size: 1rem;
      transition: all 0.2s ease;
    }
    
    .total-row:hover {
      background: rgba(52, 152, 219, 0.05);
      padding-right: 10px;
      padding-left: 10px;
      border-radius: 6px;
    }
    
    .total-row:last-child {
      border-bottom: none;
      font-weight: bold;
      font-size: 1.3rem;
      color: var(--primary);
      padding-top: 15px;
      margin-top: 10px;
      border-top: 3px solid var(--secondary);
    }
    
    .delete-btn {
      background: transparent;
      border: none;
      color: var(--accent);
      cursor: pointer;
      font-size: 20px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      font-weight: bold;
    }
    
    .delete-btn:hover {
      background: rgba(231, 76, 60, 0.1);
      transform: scale(1.2) rotate(90deg);
      color: #c0392b;
    }
    
    .delete-btn:active {
      transform: scale(1) rotate(90deg);
    }
    
    .notification {
      position: fixed;
      top: 20px;
      left: 20px;
      padding: 16px 24px;
      border-radius: 10px;
      color: white;
      font-weight: 600;
      z-index: 1000;
      opacity: 0;
      transform: translateY(-30px) scale(0.9);
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      font-size: 1rem;
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
      max-width: 350px;
    }
    
    .notification.show {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    
    .notification.success {
      background: var(--success);
    }
    
    .notification.error {
      background: var(--accent);
    }
    
    .theme-selector {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    
    .theme-option {
      width: 45px;
      height: 45px;
      border-radius: 8px;
      cursor: pointer;
      border: 3px solid transparent;
      transition: all 0.3s ease;
      position: relative;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .theme-option:hover {
      transform: scale(1.15) rotate(5deg);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    
    .theme-option.active {
      border-color: var(--dark);
      transform: scale(1.1);
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    
    .theme-option.active::after {
      content: 'âœ“';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-weight: bold;
      font-size: 18px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .template-selector {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }
    
    .template-option {
      border: 3px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      background: white;
      position: relative;
      overflow: hidden;
    }
    
    .template-option::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s;
    }
    
    .template-option:hover::before {
      left: 100%;
    }
    
    .template-option.active {
      border-color: var(--secondary);
      background: linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(52, 152, 219, 0.05) 100%);
      box-shadow: 0 4px 15px rgba(52, 152, 219, 0.2);
      transform: scale(1.05);
    }
    
    .template-option:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
      border-color: var(--secondary);
    }
    
    .template-preview {
      height: 100px;
      background: #f8f9fa;
      border-radius: 4px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      color: #666;
    }
    
    .invoice-preview {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
      margin-top: 20px;
      width: 210mm; /* Ø­Ø¬Ù… A4 Ø¹Ù…ÙˆØ¯ÙŠ */
      min-height: 297mm;
      margin: 20px auto;
      border: 2px solid var(--secondary);
      page-break-after: always;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .invoice-preview.landscape {
      width: 297mm; /* Ø­Ø¬Ù… A4 Ø£ÙÙ‚ÙŠ */
      min-height: 210mm;
    }
    
    .invoice-header-preview {
      border-bottom: 3px solid var(--secondary);
      padding-bottom: 20px;
      margin-bottom: 25px;
    }
    
    .invoice-header-preview h2 {
      color: var(--primary);
      font-size: 1.8rem;
      margin-bottom: 10px;
    }
    
    .invoice-header-preview h3 {
      color: var(--secondary);
      font-size: 1.4rem;
      margin-bottom: 8px;
    }
    
    .invoice-details-preview {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 25px;
    }
    
    .invoice-details-preview h4 {
      color: var(--primary);
      margin-bottom: 10px;
      font-size: 1.1rem;
      border-bottom: 2px solid var(--secondary);
      padding-bottom: 5px;
    }
    
    .invoice-items-preview table {
      border-collapse: separate;
      border-spacing: 0;
      border: 2px solid var(--secondary);
      border-radius: 8px;
      overflow: hidden;
    }
    
    .invoice-items-preview th {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      padding: 12px;
      font-weight: 600;
      text-align: center;
    }
    
    .invoice-items-preview td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #eee;
    }
    
    .invoice-items-preview tr:last-child td {
      border-bottom: none;
    }
    
    .invoice-items-preview tr:hover {
      background-color: #f8f9fa;
    }
    
    .invoice-totals-preview {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      padding: 20px;
      border-radius: 8px;
      margin-top: 25px;
      border: 2px solid var(--secondary);
    }
    
    .invoice-totals-preview .total-row {
      font-size: 1.1rem;
      padding: 10px 0;
    }
    
    .invoice-totals-preview .total-row:last-child {
      font-size: 1.4rem;
      font-weight: bold;
      color: var(--primary);
      border-top: 2px solid var(--secondary);
      padding-top: 15px;
      margin-top: 10px;
    }
    
    .page-break {
      page-break-after: always;
      break-after: page;
    }
    
    .invoice-header-preview {
      display: flex;
      justify-content: space-between;
      margin-bottom: 25px;
      border-bottom: 2px solid #eee;
      padding-bottom: 15px;
    }
    
    .invoice-details-preview {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .invoice-items-preview table {
      width: 100%;
      margin-bottom: 25px;
    }
    
    .invoice-totals-preview {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 25px;
    }
    
    .print-only {
      display: none;
    }
    
    .hidden-section {
      display: none;
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
      @media print {
      @page {
        size: A4;
        margin: 0;
      }
      
      body {
        background: white;
        padding: 0;
        margin: 0;
      }
      
      .no-print,
      .theme-toggle {
        display: none !important;
      }
      
      .container {
        max-width: 100%;
        margin: 0;
        padding: 0;
      }
      
      .invoice-preview {
        width: 210mm;
        min-height: 297mm;
        max-height: 297mm;
        margin: 0;
        padding: 15mm;
        box-shadow: none;
        border-radius: 0;
        page-break-after: always;
        overflow: hidden;
      }
      
      .invoice-preview.landscape {
        width: 297mm;
        min-height: 210mm;
        max-height: 210mm;
      }
      
      .print-only {
        display: block;
      }
      
      /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø®Ø·ÙˆØ· Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
      * {
        font-family: 'Arial', sans-serif !important;
      }
      
      /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± ØºÙŠØ± Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ© ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
      .tab-content:not(.active),
      header,
      .quick-actions,
      .tabs,
      .action-buttons {
        display: none !important;
      }
    }
    
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      header {
        flex-direction: column;
        text-align: center;
        padding: 15px;
      }
      
      .logo-section {
        margin-bottom: 12px;
        justify-content: center;
        width: 100%;
      }
      
      .company-info h1 {
        font-size: 1.1rem;
      }
      
      .company-info p {
        font-size: 0.8rem;
      }
      
      .tabs {
        flex-direction: row;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      .tab {
        padding: 10px 12px;
        font-size: 0.8rem;
        white-space: nowrap;
        min-width: fit-content;
      }
      
      .tab-content {
        padding: 15px;
      }
      
      .action-buttons {
        flex-direction: column;
        gap: 10px;
      }
      
      .btn {
        width: 100%;
        margin-bottom: 8px;
        padding: 12px 20px;
        font-size: 0.9rem;
      }
      
      .quick-actions {
        flex-direction: column;
        gap: 8px;
      }
      
      .quick-action-btn {
        width: 100%;
        padding: 10px;
      }
      
      table {
        display: block;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        font-size: 0.75rem;
        width: 100%;
      }
      
      th, td {
        padding: 8px 4px;
        font-size: 0.75rem;
        white-space: nowrap;
      }
      
      .invoice-preview {
        width: 100% !important;
        padding: 15px !important;
        min-height: auto !important;
        margin: 10px auto !important;
        border-radius: 8px;
      }
      
      .invoice-header-preview {
        flex-direction: column;
        gap: 15px;
        padding-bottom: 15px;
        margin-bottom: 15px;
      }
      
      .invoice-header-preview h2 {
        font-size: 1.3rem;
      }
      
      .invoice-header-preview h3 {
        font-size: 1.1rem;
      }
      
      .invoice-details-preview,
      .invoice-totals-preview {
        grid-template-columns: 1fr !important;
        gap: 10px;
        padding: 12px !important;
      }
      
      .invoice-items-preview {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      .invoice-items-preview table {
        min-width: 600px;
      }
      
      .invoice-totals-preview .total-row {
        font-size: 1rem !important;
        padding: 8px 0;
      }
      
      .invoice-totals-preview .total-row:last-child {
        font-size: 1.2rem !important;
      }
      
      .template-selector {
        grid-template-columns: 1fr;
      }
      
      .form-group {
        margin-bottom: 15px;
      }
      
      input[type="text"],
      input[type="number"],
      input[type="date"],
      input[type="email"],
      select,
      textarea {
        padding: 12px;
        font-size: 16px; /* Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ¨ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ iOS */
      }
      
      .section-title {
        font-size: 1rem;
      }
      
      .totals-section {
        padding: 12px;
      }
      
      .theme-selector {
        justify-content: center;
      }
    }
    
    @media (max-width: 480px) {
      body {
        padding: 5px;
      }
      
      header {
        padding: 10px;
      }
      
      .logo {
        width: 50px;
        height: 50px;
        font-size: 18px;
      }
      
      .company-info h1 {
        font-size: 1rem;
      }
      
      .tab {
        padding: 8px 10px;
        font-size: 0.75rem;
      }
      
      .tab-content {
        padding: 10px;
      }
      
      th, td {
        padding: 6px 3px;
        font-size: 0.7rem;
      }
      
      .invoice-preview {
        padding: 10px;
      }
      
      .savedInvoicesModal > div {
        margin: 10px;
        padding: 15px;
        max-height: 95vh;
      }
      
      .theme-toggle {
        width: 45px;
        height: 45px;
        top: 10px;
        left: 10px;
        font-size: 18px;
      }
      
      .qr-code-top {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
      
      .company-logo-header {
        margin-bottom: 15px;
      }
      
      .company-logo-preview {
        max-width: 120px;
        max-height: 120px;
      }
      
      .developer-contact {
        padding: 15px;
      }
      
      .developer-contact h3 {
        font-size: 1rem;
      }
      
      .whatsapp-btn {
        padding: 10px 20px;
        font-size: 0.9rem;
      }
      
      #quickAddModal > div {
        margin: 10px;
        padding: 15px;
        max-height: 95vh;
      }
      
      .quick-actions {
        flex-direction: column;
      }
      
      .quick-action-btn {
        width: 100%;
        margin-bottom: 8px;
      }
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
    @media (max-width: 768px) {
      .savedInvoicesModal > div {
        margin: 10px;
        padding: 15px;
      }
      
      #savedInvoicesList > div {
        padding: 12px !important;
      }
      
      #savedInvoicesList button {
        width: 100%;
        margin-bottom: 8px;
      }
    }
    
    /* ØªØµÙ…ÙŠÙ…Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø®ØªÙ„ÙØ© */
    .invoice-template-modern {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      border: 2px solid #3498db;
    }
    
    .invoice-template-classic {
      font-family: Georgia, 'Times New Roman', Times, serif;
      border: 2px solid #2c3e50;
    }
    
    .invoice-template-minimal {
      font-family: Arial, Helvetica, sans-serif;
      border: 1px solid #ddd;
    }
    
    .invoice-template-colorful {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      border: 2px solid #e74c3c;
    }
    
    .invoice-template-professional {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      border: 2px solid #27ae60;
    }
    
    .quick-actions {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .quick-action-btn {
      padding: 10px 18px;
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border: 2px solid #dee2e6;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    
    .quick-action-btn:hover {
      background: linear-gradient(135deg, var(--secondary) 0%, #2980b9 100%);
      color: white;
      border-color: var(--secondary);
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
    }
    
    .quick-action-btn:active {
      transform: translateY(-1px);
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø´Ø±ÙƒØ§Øª */
    .section-title {
      position: relative;
    }
    
    .section-title::before {
      content: '';
      position: absolute;
      right: 0;
      bottom: -2px;
      width: 60px;
      height: 3px;
      background: var(--secondary);
      border-radius: 2px;
    }
    
    input[type="text"]:focus,
    input[type="number"]:focus,
    input[type="date"]:focus,
    input[type="email"]:focus,
    select:focus,
    textarea:focus {
      border-color: var(--secondary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
      transform: translateY(-1px);
      transition: all 0.3s ease;
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ */
    .editable-cell {
      transition: all 0.2s ease;
      border: 1px solid transparent !important;
      background: transparent !important;
    }
    
    .editable-cell:focus {
      background-color: rgba(52, 152, 219, 0.05) !important;
      border-color: var(--secondary) !important;
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1) !important;
    }
    
    .editable-cell:hover {
      background-color: rgba(52, 152, 219, 0.02) !important;
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
    .loading {
      opacity: 0.7;
      pointer-events: none;
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© */
    .image-saving {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      color: white;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
  <button class="theme-toggle" onclick="toggleDarkMode()" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ">
    ğŸŒ™
  </button>
  
  <div class="container no-print">
    <header>
      <div class="logo-section">
        <div class="logo" id="companyLogo">Ø´</div>
        <div class="company-info">
          <h1 contenteditable="true" id="companyName">Ø´Ø±ÙƒØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©</h1>
          <p contenteditable="true" id="companyDescription">ÙˆØµÙ Ø´Ø±ÙƒØªÙƒ ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§</p>
          <p contenteditable="true" id="companyAddress">Ø¹Ù†ÙˆØ§Ù† Ø´Ø±ÙƒØªÙƒ</p>
          <p contenteditable="true" id="companyContact">Ù‡Ø§ØªÙ: 0123456789 | Ø§Ù„Ø¨Ø±ÙŠØ¯: info@company.com</p>
        </div>
      </div>
      <div class="invoice-header">
        <h2>Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù… <span class="company-badge">PRO</span></h2>
        <p>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: <strong id="invoiceNumberDisplay">INV-2023-001</strong></p>
      </div>
    </header>
    
    <div class="quick-actions">
      <button class="quick-action-btn" onclick="addRow()">â• Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯</button>
      <button class="quick-action-btn" onclick="quickAddProduct()">âš¡ Ø¥Ø¶Ø§ÙØ© Ø³Ø±ÙŠØ¹Ø©</button>
      <button class="quick-action-btn" onclick="duplicateLastRow()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø¨Ù†Ø¯ Ø§Ù„Ø£Ø®ÙŠØ±</button>
      <button class="quick-action-btn" onclick="clearAllRows()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
      <button class="quick-action-btn" onclick="fillSampleData()">ğŸ”„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
      <button class="quick-action-btn" onclick="loadSavedInvoices()">ğŸ“‚ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</button>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
    <div id="quickAddModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 3000; overflow-y: auto;">
      <div style="background: white; margin: 20px auto; max-width: 500px; padding: 20px; border-radius: 8px; max-height: 90vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="color: var(--primary); margin: 0;">âš¡ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø³Ø±ÙŠØ¹Ø©</h2>
          <button class="btn btn-danger" onclick="closeQuickAddModal()" style="padding: 8px 15px;">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
        <div class="form-group">
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:</label>
          <input type="text" id="quickProductName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" style="width: 100%; padding: 10px; margin-top: 5px;">
        </div>
        <div class="form-group">
          <label>Ø§Ù„ÙƒÙ…ÙŠØ©:</label>
          <input type="number" id="quickQuantity" value="1" min="1" style="width: 100%; padding: 10px; margin-top: 5px;">
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ø³Ø¹Ø±:</label>
          <input type="number" id="quickPrice" value="0" min="0" step="0.01" style="width: 100%; padding: 10px; margin-top: 5px;">
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© %:</label>
          <input type="number" id="quickTax" value="0" min="0" max="100" step="0.01" style="width: 100%; padding: 10px; margin-top: 5px;">
        </div>
        <button class="btn btn-success" onclick="addQuickProduct()" style="width: 100%; margin-top: 15px; padding: 12px;">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>
      </div>
    </div>
    
    <div class="tabs">
      <button class="tab active" onclick="openTab('client-tab', this)">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
      <button class="tab" onclick="openTab('items-tab', this)">Ø§Ù„Ø¨Ù†ÙˆØ¯</button>
      <button class="tab" onclick="openTab('payment-tab', this)">Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„Ø´Ø­Ù†</button>
      <button class="tab" onclick="openTab('design-tab', this)">Ø§Ù„ØªØµÙ…ÙŠÙ…</button>
      <button class="tab" onclick="openTab('preview-tab', this)">Ù…Ø¹Ø§ÙŠÙ†Ø©</button>
    </div>
    
    <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
    <div id="client-tab" class="tab-content active">
      <div class="section">
        <h3 class="section-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
        <div class="form-group">
          <label for="clientName">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
          <input type="text" id="clientName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" oninput="checkPaymentFields()">
        </div>
        <div class="form-group">
          <label for="clientEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input type="email" id="clientEmail" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" oninput="checkPaymentFields()">
        </div>
        <div class="form-group">
          <label for="clientPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
          <input type="text" id="clientPhone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" oninput="checkPaymentFields()">
        </div>
        <div class="form-group">
          <label for="clientAddress">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
          <textarea id="clientAddress" rows="2" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„" oninput="checkPaymentFields()"></textarea>
        </div>
      </div>
      
      <div class="section">
        <h3 class="section-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
        <div class="form-group">
          <label for="invoiceDate">ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
          <input type="date" id="invoiceDate">
        </div>
        <div class="form-group">
          <label for="dueDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</label>
          <input type="date" id="dueDate">
        </div>
        <div class="form-group">
          <label for="dealDetails">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµÙÙ‚Ø©</label>
          <textarea id="dealDetails" rows="2" placeholder="Ø£Ø¯Ø®Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµÙÙ‚Ø©"></textarea>
        </div>
      </div>
      
      <div class="action-buttons">
        <button class="btn btn-primary" onclick="openTab('items-tab', document.querySelector('.tab[onclick*=&quot;items-tab&quot;]'))">Ø§Ù„ØªØ§Ù„ÙŠ â†’</button>
      </div>
    </div>
    
    <!-- Ø¨Ù†ÙˆØ¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
    <div id="items-tab" class="tab-content">
      <div class="section">
        <h3 class="section-title">Ø¨Ù†ÙˆØ¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
          <button class="btn btn-outline" onclick="addRow()">â• Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø±</button>
        </h3>
        <table id="itemsTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
              <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
              <th>Ø§Ù„Ø³Ø¹Ø±</th>
              <th>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© %</th>
              <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
              <th>Ø­Ø°Ù</th>
            </tr>
          </thead>
          <tbody id="itemsBody">
            <tr>
              <td>1</td>
              <td><input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ (Ù…Ø·Ù„ÙˆØ¨)" class="product editable-cell" required></td>
              <td><input type="number" class="quantity editable-cell" value="1" min="1" oninput="calculateTotal(this)"></td>
              <td><input type="number" class="price editable-cell" value="0" min="0" step="0.01" oninput="calculateTotal(this)"></td>
              <td><input type="number" class="tax editable-cell" value="0" min="0" max="100" step="0.01" oninput="calculateTotal(this)"></td>
              <td class="lineTotal">0.00</td>
              <td><button class="delete-btn" onclick="deleteRow(this)">Ã—</button></td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <div class="totals-section">
        <div class="total-row">
          <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>
          <span id="subtotal">0.00</span>
        </div>
        <div class="total-row">
          <span>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</span>
          <span id="taxTotal">0.00</span>
        </div>
        <div class="total-row">
          <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span>
          <span id="grandTotal">0.00</span>
        </div>
      </div>
      
      <div class="action-buttons">
        <button class="btn btn-outline" onclick="openTab('client-tab', document.querySelector('.tab[onclick*=&quot;client-tab&quot;]'))">â† Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
        <button class="btn btn-primary" onclick="openTab('payment-tab', document.querySelector('.tab[onclick*=&quot;payment-tab&quot;]'))">Ø§Ù„ØªØ§Ù„ÙŠ â†’</button>
      </div>
    </div>
    
    <!-- Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„Ø´Ø­Ù† -->
    <div id="payment-tab" class="tab-content">
      <div class="section" id="paymentSection">
        <h3 class="section-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙØ¹</h3>
        <div class="form-group">
          <label for="paymentMethod">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
          <select id="paymentMethod" onchange="checkPaymentFields()">
            <option value="">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</option>
            <option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
            <option value="credit">Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†</option>
            <option value="bank">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
            <option value="check">Ø´ÙŠÙƒ</option>
          </select>
        </div>
        <div class="form-group">
          <label for="paymentDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹</label>
          <input type="date" id="paymentDate" onchange="checkPaymentFields()">
        </div>
        <div class="form-group">
          <label for="paymentReference">Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹</label>
          <input type="text" id="paymentReference" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ (Ø¥Ù† ÙˆØ¬Ø¯)" oninput="checkPaymentFields()">
        </div>
      </div>
      
      <div class="section" id="shippingSection">
        <h3 class="section-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø­Ù†</h3>
        <div class="form-group">
          <label for="shippingAddress">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø­Ù†</label>
          <textarea id="shippingAddress" rows="2" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø­Ù†" oninput="checkPaymentFields()"></textarea>
        </div>
        <div class="form-group">
          <label for="shippingMethod">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø´Ø­Ù†</label>
          <select id="shippingMethod" onchange="checkPaymentFields()">
            <option value="">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø´Ø­Ù†</option>
            <option value="standard">Ø´Ø­Ù† Ø¹Ø§Ø¯ÙŠ</option>
            <option value="express">Ø´Ø­Ù† Ø³Ø±ÙŠØ¹</option>
            <option value="pickup">Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±</option>
          </select>
        </div>
        <div class="form-group">
          <label for="shippingCost">ØªÙƒÙ„ÙØ© Ø§Ù„Ø´Ø­Ù†</label>
          <input type="number" id="shippingCost" value="0" min="0" step="0.01" oninput="updateShipping()">
        </div>
      </div>
      
      <div class="action-buttons">
        <button class="btn btn-outline" onclick="openTab('items-tab', document.querySelector('.tab[onclick*=&quot;items-tab&quot;]'))">â† Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
        <button class="btn btn-primary" onclick="openTab('design-tab', document.querySelector('.tab[onclick*=&quot;design-tab&quot;]'))">Ø§Ù„ØªØ§Ù„ÙŠ â†’</button>
      </div>
    </div>
    
    <!-- Ø§Ù„ØªØµÙ…ÙŠÙ… -->
    <div id="design-tab" class="tab-content">
      <div class="section">
        <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØµÙ…ÙŠÙ…</h3>
        <div class="form-group">
          <label>Ø§Ø®ØªØ± ØªØµÙ…ÙŠÙ… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</label>
          <div class="theme-selector">
            <div class="theme-option active" style="background: #2c3e50;" onclick="changeTheme('default', this)"></div>
            <div class="theme-option" style="background: #27ae60;" onclick="changeTheme('green', this)"></div>
            <div class="theme-option" style="background: #e74c3c;" onclick="changeTheme('red', this)"></div>
            <div class="theme-option" style="background: #9b59b6;" onclick="changeTheme('purple', this)"></div>
            <div class="theme-option" style="background: #f39c12;" onclick="changeTheme('orange', this)"></div>
          </div>
        </div>
        
        <div class="form-group">
          <label>Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨ Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</label>
          <div class="template-selector">
            <div class="template-option active" onclick="selectTemplate('modern', this)">
              <div class="template-preview">Ø­Ø¯ÙŠØ«</div>
              <span>Ù‚Ø§Ù„Ø¨ Ø­Ø¯ÙŠØ«</span>
            </div>
            <div class="template-option" onclick="selectTemplate('classic', this)">
              <div class="template-preview">ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ</div>
              <span>Ù‚Ø§Ù„Ø¨ ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ</span>
            </div>
            <div class="template-option" onclick="selectTemplate('minimal', this)">
              <div class="template-preview">Ø¨Ø³ÙŠØ·</div>
              <span>Ù‚Ø§Ù„Ø¨ Ø¨Ø³ÙŠØ·</span>
            </div>
            <div class="template-option" onclick="selectTemplate('colorful', this)">
              <div class="template-preview">Ù…Ù„ÙˆÙ†</div>
              <span>Ù‚Ø§Ù„Ø¨ Ù…Ù„ÙˆÙ†</span>
            </div>
            <div class="template-option" onclick="selectTemplate('professional', this)">
              <div class="template-preview">Ø§Ø­ØªØ±Ø§ÙÙŠ</div>
              <span>Ù‚Ø§Ù„Ø¨ Ø§Ø­ØªØ±Ø§ÙÙŠ</span>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="logoText">Ù†Øµ Ø§Ù„Ø´Ø¹Ø§Ø±:</label>
          <input type="text" id="logoText" value="Ø´" oninput="updateLogo()">
        </div>
        
        <div class="form-group">
          <label for="logoColor">Ù„ÙˆÙ† Ø§Ù„Ø´Ø¹Ø§Ø±:</label>
          <input type="color" id="logoColor" value="#3498db" onchange="updateLogo()">
        </div>
        
        <div class="form-group logo-upload-container">
          <label>Ø±ÙØ¹ Ù„ÙˆØ¬Ùˆ Ø§Ù„Ø´Ø±ÙƒØ©:</label>
          <input type="file" id="logoUpload" accept="image/*" onchange="handleLogoUpload(event)" style="margin-top: 8px;">
          <div class="logo-preview" id="logoPreview">
            <img id="logoPreviewImg" src="" alt="Logo Preview">
          </div>
          <button class="btn btn-danger" onclick="removeLogo()" style="margin-top: 8px; display: none;" id="removeLogoBtn">ğŸ—‘ï¸ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù„ÙˆØ¬Ùˆ</button>
        </div>
        
        <div class="form-group">
          <label>
            <input type="checkbox" id="showQRCode" onchange="updatePreview()">
            Ø¥Ø¸Ù‡Ø§Ø± Ø±Ù…Ø² QR ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
          </label>
        </div>
        
        <div class="form-group" id="qrCustomSection" style="display: none; margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 6px; border: 1px solid var(--border-color);">
          <label for="qrCustomLink">ØªØ®ØµÙŠØµ Ø±Ù…Ø² QR (Ø±Ø§Ø¨Ø· Ù…Ø®ØµØµ):</label>
          <input type="text" id="qrCustomLink" placeholder="https://example.com Ø£Ùˆ Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©" style="margin-top: 8px; width: 100%;">
          <p style="font-size: 0.85rem; color: #666; margin-top: 8px;">ğŸ’¡ Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ù…ÙˆÙ‚Ø¹Ùƒ Ø£Ùˆ ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹</p>
        </div>
      </div>
      
      <div class="action-buttons">
        <button class="btn btn-outline" onclick="openTab('payment-tab', document.querySelector('.tab[onclick*=&quot;payment-tab&quot;]'))">â† Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
        <button class="btn btn-primary" onclick="openTab('preview-tab', document.querySelector('.tab[onclick*=&quot;preview-tab&quot;]'))">Ù…Ø¹Ø§ÙŠÙ†Ø© â†’</button>
      </div>
    </div>
    
    <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
    <div id="preview-tab" class="tab-content">
      <div class="section">
        <h3 class="section-title">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
        <div class="form-group" style="margin-bottom: 15px;">
          <label for="pageOrientation">Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØµÙØ­Ø©:</label>
          <select id="pageOrientation" onchange="changePageOrientation()" style="max-width: 200px;">
            <option value="portrait">Ø¹Ù…ÙˆØ¯ÙŠ (A4)</option>
            <option value="landscape">Ø£ÙÙ‚ÙŠ (A4)</option>
          </select>
        </div>
        <div class="form-group" style="margin-bottom: 15px;">
          <label for="itemsPerPage">Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©:</label>
          <input type="number" id="itemsPerPage" value="15" min="5" max="50" style="max-width: 200px;" onchange="updatePageCount()">
          <span id="pageCountDisplay" style="margin-right: 10px; color: var(--secondary); font-weight: bold;"></span>
        </div>
        <div class="invoice-preview" id="invoicePreview">
          <!-- Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ -->
          <div class="company-logo-header" id="companyLogoHeaderContainer" style="display: none;">
            <img id="companyLogoPreview" class="company-logo-preview" src="" alt="Company Logo">
          </div>
          
          <!-- QR Code ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ø£Ø¹Ù„Ù‰ -->
          <div id="qrCodeTopContainer" class="qr-code-top" style="display: none;">
            <div class="qr-code-top-center">
              <div id="qrcodeTop"></div>
            </div>
          </div>
          
          <div class="invoice-header-preview">
            <div>
              <h2 id="previewCompanyName">Ø´Ø±ÙƒØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©</h2>
              <p id="previewCompanyDescription">ÙˆØµÙ Ø´Ø±ÙƒØªÙƒ ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§</p>
              <p id="previewCompanyAddress">Ø¹Ù†ÙˆØ§Ù† Ø´Ø±ÙƒØªÙƒ</p>
              <p id="previewCompanyContact">Ù‡Ø§ØªÙ: 0123456789 | Ø§Ù„Ø¨Ø±ÙŠØ¯: info@company.com</p>
            </div>
            <div>
              <h3>ÙØ§ØªÙˆØ±Ø© #<span id="previewInvoiceNumber">INV-2023-001</span></h3>
              <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: <span id="previewInvoiceDate">-</span></p>
              <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: <span id="previewDueDate">-</span></p>
            </div>
          </div>
          
          <div class="invoice-details-preview">
            <div>
              <h4>Ø§Ù„Ø¹Ù…ÙŠÙ„:</h4>
              <p id="previewClientName">-</p>
              <p id="previewClientContact">-</p>
              <p id="previewClientAddress">-</p>
            </div>
            <div id="previewPaymentSection" class="hidden-section">
              <h4>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹:</h4>
              <p>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: <span id="previewPaymentMethod">-</span></p>
              <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹: <span id="previewPaymentDate">-</span></p>
            </div>
          </div>
          
          <div class="invoice-items-preview">
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                  <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                  <th>Ø§Ù„Ø³Ø¹Ø±</th>
                  <th>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</th>
                  <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                </tr>
              </thead>
              <tbody id="previewItemsBody">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
              </tbody>
            </table>
          </div>
          
          <div class="invoice-totals-preview">
            <div></div>
            <div>
              <div class="total-row">
                <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>
                <span id="previewSubtotal">0.00</span>
              </div>
              <div class="total-row">
                <span>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</span>
                <span id="previewTaxTotal">0.00</span>
              </div>
              <div class="total-row">
                <span>Ø§Ù„Ø´Ø­Ù†:</span>
                <span id="previewShipping">0.00</span>
              </div>
              <div class="total-row">
                <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span>
                <span id="previewGrandTotal">0.00</span>
              </div>
            </div>
          </div>
          
          <div class="print-only">
            <p>Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§</p>
            <p>Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª: Ù‡Ø§ØªÙ: 0123456789 | Ø§Ù„Ø¨Ø±ÙŠØ¯: info@company.com</p>
          </div>
        </div>
      </div>
      
      <div class="action-buttons">
        <button class="btn btn-outline" onclick="openTab('design-tab', document.querySelector('.tab[onclick*=&quot;design-tab&quot;]'))">â† Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
        <button class="btn btn-success" onclick="saveInvoice()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
        <button class="btn btn-primary" onclick="downloadAsPDF()">ğŸ“„ ØªÙ†Ø²ÙŠÙ„ PDF</button>
        <button class="btn btn-outline" onclick="printInvoice()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
        <button class="btn btn-info" onclick="saveAsImage()">ğŸ“· Ø­ÙØ¸ ÙƒØµÙˆØ±Ø© (PNG ØºÙŠØ± Ù…Ø¶ØºÙˆØ·)</button>
        <button class="btn btn-danger" onclick="clearInvoice()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
      </div>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø·ÙˆØ± -->
    <div class="developer-contact no-print">
      <h3>ğŸ’¼ ØªØ·ÙˆÙŠØ± ÙˆØªØµÙ…ÙŠÙ…</h3>
      <p><strong>Ø§Ù„Ù…Ø·ÙˆØ±:</strong> Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ ÙØ¤Ø§Ø¯</p>
      <p>Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±</p>
      <a href="https://wa.me/201010421571" target="_blank" class="whatsapp-btn">
        <span>ğŸ“±</span>
        <span>ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</span>
      </a>
      <p style="margin-top: 15px; font-size: 0.85rem; opacity: 0.9;">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨: +201010421571</p>
    </div>
  </div>
  
  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© -->
  <div id="savedInvoicesModal" class="savedInvoicesModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 3000; overflow-y: auto;">
    <div style="background: white; margin: 20px auto; max-width: 800px; padding: 20px; border-radius: 8px; max-height: 90vh; overflow-y: auto;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
        <h2 style="color: var(--primary); margin: 0;">Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h2>
        <button class="btn btn-danger" onclick="closeSavedInvoicesModal()" style="padding: 8px 15px;">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div id="savedInvoicesList"></div>
    </div>
  </div>

  <script>
    // ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ÙƒØªØ§Ø±ÙŠØ® Ø§ÙØªØ±Ø§Ø¶ÙŠ
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('invoiceDate').value = today;
    
    // Ø¥Ø¶Ø§ÙØ© 30 ÙŠÙˆÙ…Ù‹Ø§ Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚
    const dueDate = new Date();
    dueDate.setDate(dueDate.getDate() + 30);
    document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
    
    // ÙØªØ­ Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
    function openTab(tabId, eventElement) {
      // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ¨ÙˆÙŠØ¨
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
      document.getElementById(tabId).classList.add('active');
      
      // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø´Ø§Ø· Ù„Ø²Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
      if (eventElement) {
        eventElement.classList.add('active');
      } else {
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
        document.querySelectorAll('.tab').forEach(tab => {
          if (tab.getAttribute('onclick') && tab.getAttribute('onclick').includes(tabId)) {
            tab.classList.add('active');
          }
        });
      }
      
      // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¹Ù„Ø§Ù…Ø© ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù„Ø®ØµØŒ Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      if (tabId === 'preview-tab') {
        updatePreview();
      }
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¬Ø¯ÙˆÙ„
    function addRow() {
      const table = document.getElementById("itemsBody");
      const rowCount = table.rows.length + 1;
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${rowCount}</td>
        <td><input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ (Ù…Ø·Ù„ÙˆØ¨)" class="product editable-cell" required></td>
        <td><input type="number" class="quantity editable-cell" value="1" min="1" oninput="calculateTotal(this)"></td>
        <td><input type="number" class="price editable-cell" value="0" min="0" step="0.01" oninput="calculateTotal(this)"></td>
        <td><input type="number" class="tax editable-cell" value="0" min="0" max="100" step="0.01" oninput="calculateTotal(this)"></td>
        <td class="lineTotal">0.00</td>
        <td><button class="delete-btn" onclick="deleteRow(this)">Ã—</button></td>
      `;
      table.appendChild(row);
      showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }
    
    // Ù†Ø³Ø® Ø§Ù„Ø¨Ù†Ø¯ Ø§Ù„Ø£Ø®ÙŠØ±
    function duplicateLastRow() {
      const table = document.getElementById("itemsBody");
      if (table.rows.length === 0) return;
      
      const lastRow = table.rows[table.rows.length - 1];
      const rowCount = table.rows.length + 1;
      const row = document.createElement("tr");
      
      // Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØµÙ Ø§Ù„Ø£Ø®ÙŠØ±
      const product = lastRow.cells[1].querySelector("input").value;
      const quantity = lastRow.cells[2].querySelector("input").value;
      const price = lastRow.cells[3].querySelector("input").value;
      const tax = lastRow.cells[4].querySelector("input").value;
      
      row.innerHTML = `
        <td>${rowCount}</td>
        <td><input type="text" value="${product}" class="product editable-cell" required></td>
        <td><input type="number" class="quantity editable-cell" value="${quantity}" min="1" oninput="calculateTotal(this)"></td>
        <td><input type="number" class="price editable-cell" value="${price}" min="0" step="0.01" oninput="calculateTotal(this)"></td>
        <td><input type="number" class="tax editable-cell" value="${tax}" min="0" max="100" step="0.01" oninput="calculateTotal(this)"></td>
        <td class="lineTotal">0.00</td>
        <td><button class="delete-btn" onclick="deleteRow(this)">Ã—</button></td>
      `;
      table.appendChild(row);
      calculateTotal(row.querySelector('.quantity'));
      showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¨Ù†Ø¯ Ø§Ù„Ø£Ø®ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }
    
    // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù†ÙˆØ¯
    function clearAllRows() {
      if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù†ÙˆØ¯ØŸ')) {
        const itemsBody = document.getElementById('itemsBody');
        itemsBody.innerHTML = '';
        addRow(); // Ø¥Ø¶Ø§ÙØ© ØµÙ ÙØ§Ø±Øº
        updateTotals();
        showNotification('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù†ÙˆØ¯', 'success');
      }
    }
    
    // Ø­Ø°Ù Ø³Ø·Ø± Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
    function deleteRow(button) {
      const row = button.parentElement.parentElement;
      if (document.getElementById("itemsBody").rows.length > 1) {
        row.remove();
        updateRowNumbers();
        updateTotals();
        showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø·Ø± Ø¨Ù†Ø¬Ø§Ø­', 'success');
      } else {
        showNotification('ÙŠØ¬Ø¨ Ø£Ù† ØªØ­ØªÙˆÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ù„Ù‰ Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
      }
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø£Ø³Ø·Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
    function updateRowNumbers() {
      const rows = document.querySelectorAll("#itemsBody tr");
      rows.forEach((row, index) => {
        row.cells[0].textContent = index + 1;
      });
    }
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„Ù„Ø³Ø·Ø±
    function calculateTotal(input) {
      if (!input || !input.parentElement) return;
      
      const row = input.closest('tr');
      if (!row) return;
      
      const quantityInput = row.querySelector(".quantity");
      const priceInput = row.querySelector(".price");
      const taxInput = row.querySelector(".tax");
      const totalCell = row.querySelector(".lineTotal");
      
      if (!quantityInput || !priceInput || !taxInput || !totalCell) return;
      
      const quantity = parseFloat(quantityInput.value) || 0;
      const price = parseFloat(priceInput.value) || 0;
      const taxRate = parseFloat(taxInput.value) || 0;
      
      const subtotal = quantity * price;
      const taxAmount = subtotal * (taxRate / 100);
      const total = subtotal + taxAmount;
      
      totalCell.textContent = total.toFixed(2);
      debouncedUpdateTotals();
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª (ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø¨Ø¯ÙˆÙ† Ù…Ù†ØªØ¬)
    function updateTotals() {
      let subtotal = 0, taxTotal = 0;
      
      const itemsBody = document.getElementById("itemsBody");
      if (!itemsBody) return;
      
      const rows = itemsBody.querySelectorAll("tr");
      rows.forEach(row => {
        if (!row || !row.cells || row.cells.length < 6) return;
        
        // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬
        const productInput = row.cells[1]?.querySelector("input");
        if (!productInput) return;
        
        const product = productInput.value.trim();
        if (!product) {
          return;
        }
        
        const quantityInput = row.querySelector(".quantity");
        const priceInput = row.querySelector(".price");
        const taxInput = row.querySelector(".tax");
        
        if (!quantityInput || !priceInput || !taxInput) return;
        
        const quantity = parseFloat(quantityInput.value) || 0;
        const price = parseFloat(priceInput.value) || 0;
        const taxRate = parseFloat(taxInput.value) || 0;
        
        const lineSubtotal = quantity * price;
        const lineTax = lineSubtotal * (taxRate / 100);
        
        subtotal += lineSubtotal;
        taxTotal += lineTax;
      });
      
      const shippingInput = document.getElementById("shippingCost");
      const shippingCost = shippingInput ? parseFloat(shippingInput.value) || 0 : 0;
      const grandTotal = subtotal + taxTotal + shippingCost;
      
      const subtotalEl = document.getElementById("subtotal");
      const taxTotalEl = document.getElementById("taxTotal");
      const grandTotalEl = document.getElementById("grandTotal");
      
      if (subtotalEl) subtotalEl.textContent = subtotal.toFixed(2);
      if (taxTotalEl) taxTotalEl.textContent = taxTotal.toFixed(2);
      if (grandTotalEl) grandTotalEl.textContent = grandTotal.toFixed(2);
      
      // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª
      updatePageCount();
    }
    
    // ØªØ­Ø¯ÙŠØ« ØªÙƒÙ„ÙØ© Ø§Ù„Ø´Ø­Ù†
    function updateShipping() {
      updateTotals();
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¯ÙØ¹ ÙˆØ¥Ø¸Ù‡Ø§Ø±Ù‡Ø§/Ø¥Ø®ÙØ§Ø¤Ù‡Ø§
    function checkPaymentFields() {
      const paymentMethod = document.getElementById("paymentMethod").value;
      const paymentDate = document.getElementById("paymentDate").value;
      const paymentReference = document.getElementById("paymentReference").value;
      const shippingAddress = document.getElementById("shippingAddress").value;
      const shippingMethod = document.getElementById("shippingMethod").value;
      
      const previewPaymentSection = document.getElementById("previewPaymentSection");
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ø§Ù„Ø¯ÙØ¹ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª
      if (paymentMethod || paymentDate || paymentReference || shippingAddress || shippingMethod) {
        previewPaymentSection.classList.remove("hidden-section");
      } else {
        previewPaymentSection.classList.add("hidden-section");
      }
    }
    
    // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
    function updatePreview() {
      document.getElementById("previewCompanyName").textContent = 
        document.getElementById("companyName").textContent || 'Ø´Ø±ÙƒØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©';
      
      document.getElementById("previewCompanyDescription").textContent = 
        document.getElementById("companyDescription").textContent || 'ÙˆØµÙ Ø´Ø±ÙƒØªÙƒ ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§';
      
      document.getElementById("previewCompanyAddress").textContent = 
        document.getElementById("companyAddress").textContent || 'Ø¹Ù†ÙˆØ§Ù† Ø´Ø±ÙƒØªÙƒ';
      
      document.getElementById("previewCompanyContact").textContent = 
        document.getElementById("companyContact").textContent || 'Ù‡Ø§ØªÙ: 0123456789 | Ø§Ù„Ø¨Ø±ÙŠØ¯: info@company.com';
      
      document.getElementById("previewInvoiceNumber").textContent = 
        document.getElementById("invoiceNumberDisplay").textContent;
      
      document.getElementById("previewInvoiceDate").textContent = 
        document.getElementById("invoiceDate").value || '-';
      
      document.getElementById("previewDueDate").textContent = 
        document.getElementById("dueDate").value || '-';
      
      document.getElementById("previewClientName").textContent = 
        document.getElementById("clientName").value || '-';
      
      document.getElementById("previewClientContact").textContent = 
        `${document.getElementById("clientPhone").value || ''} ${document.getElementById("clientEmail").value || ''}`;
      
      document.getElementById("previewClientAddress").textContent = 
        document.getElementById("clientAddress").value || '-';
      
      const paymentMethod = document.getElementById("paymentMethod");
      document.getElementById("previewPaymentMethod").textContent = 
        paymentMethod.options[paymentMethod.selectedIndex].text || '-';
      
      document.getElementById("previewPaymentDate").textContent = 
        document.getElementById("paymentDate").value || '-';
      
      document.getElementById("previewSubtotal").textContent = 
        document.getElementById("subtotal").textContent;
      
      document.getElementById("previewTaxTotal").textContent = 
        document.getElementById("taxTotal").textContent;
      
      document.getElementById("previewShipping").textContent = 
        document.getElementById("shippingCost").value || '0.00';
      
      document.getElementById("previewGrandTotal").textContent = 
        document.getElementById("grandTotal").textContent;
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ù†ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© (Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø¨Ø¯ÙˆÙ† Ù…Ù†ØªØ¬)
      const previewItemsBody = document.getElementById("previewItemsBody");
      previewItemsBody.innerHTML = '';
      
      let validRowNumber = 1;
      document.querySelectorAll("#itemsBody tr").forEach(row => {
        const product = row.cells[1].querySelector("input")?.value.trim();
        
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬
        if (!product) {
          return;
        }
        
        const quantity = row.cells[2].querySelector("input").value || '0';
        const price = row.cells[3].querySelector("input").value || '0';
        const taxRate = row.cells[4].querySelector("input").value || '0';
        const total = row.cells[5].textContent || '0';
        
        const itemRow = document.createElement("tr");
        itemRow.innerHTML = `
          <td>${validRowNumber}</td>
          <td>${product}</td>
          <td>${quantity}</td>
          <td>${price}</td>
          <td>${taxRate}%</td>
          <td>${total}</td>
        `;
        previewItemsBody.appendChild(itemRow);
        validRowNumber++;
      });
      
      // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª
      updatePageCount();
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ø¯ÙØ¹
      checkPaymentFields();
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    function updatePageCount() {
      const itemsPerPage = parseInt(document.getElementById('itemsPerPage').value) || 15;
      const validItems = Array.from(document.querySelectorAll("#itemsBody tr")).filter(row => {
        const product = row.cells[1].querySelector("input")?.value.trim();
        return product && product.length > 0;
      });
      const totalItems = validItems.length;
      const totalPages = Math.ceil(totalItems / itemsPerPage);
      const pageCountDisplay = document.getElementById('pageCountDisplay');
      if (pageCountDisplay) {
        pageCountDisplay.textContent = totalPages > 0 ? `(Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª: ${totalPages})` : '(Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù†ÙˆØ¯)';
      }
    }
    
    // ØªØºÙŠÙŠØ± Ø§Ù„ØªØµÙ…ÙŠÙ…
    function changeTheme(theme, element) {
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
      document.querySelectorAll('.theme-option').forEach(option => {
        option.classList.remove('active');
      });
      
      // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø´Ø§Ø· Ù„Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯
      if (element) {
        element.classList.add('active');
      }
      
      // ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø®ØªØ§Ø±
      const root = document.documentElement;
      switch(theme) {
        case 'green':
          root.style.setProperty('--primary', '#27ae60');
          root.style.setProperty('--secondary', '#2ecc71');
          break;
        case 'red':
          root.style.setProperty('--primary', '#c0392b');
          root.style.setProperty('--secondary', '#e74c3c');
          break;
        case 'purple':
          root.style.setProperty('--primary', '#8e44ad');
          root.style.setProperty('--secondary', '#9b59b6');
          break;
        case 'orange':
          root.style.setProperty('--primary', '#d35400');
          root.style.setProperty('--secondary', '#f39c12');
          break;
        default:
          root.style.setProperty('--primary', '#2c3e50');
          root.style.setProperty('--secondary', '#3498db');
      }
    }
    
    // Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø§Ù„Ø¨ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
    function selectTemplate(template, element) {
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨
      document.querySelectorAll('.template-option').forEach(option => {
        option.classList.remove('active');
      });
      
      // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø´Ø§Ø· Ù„Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
      if (element) {
        element.classList.add('active');
      }
      
      // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨
      const preview = document.getElementById('invoicePreview');
      preview.classList.remove('invoice-template-modern', 'invoice-template-classic', 
                               'invoice-template-minimal', 'invoice-template-colorful', 
                               'invoice-template-professional');
      
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ù…Ø­Ø¯Ø¯
      preview.classList.add(`invoice-template-${template}`);
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø¹Ø§Ø±
    function updateLogo() {
      const logoText = document.getElementById('logoText').value;
      const logoColor = document.getElementById('logoColor').value;
      
      const logo = document.getElementById('companyLogo');
      logo.textContent = logoText;
      logo.style.background = logoColor;
    }
    
    // Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
    function saveInvoice() {
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸
      updatePreview();
      
      // Ø¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©
      const invoiceData = {
        invoiceNumber: document.getElementById('invoiceNumberDisplay').textContent,
        invoiceDate: document.getElementById('invoiceDate').value,
        dueDate: document.getElementById('dueDate').value,
        pageOrientation: document.getElementById('pageOrientation').value,
        itemsPerPage: parseInt(document.getElementById('itemsPerPage').value) || 15,
        company: {
          name: document.getElementById('companyName').textContent,
          description: document.getElementById('companyDescription').textContent,
          address: document.getElementById('companyAddress').textContent,
          contact: document.getElementById('companyContact').textContent
        },
        client: {
          name: document.getElementById('clientName').value,
          email: document.getElementById('clientEmail').value,
          phone: document.getElementById('clientPhone').value,
          address: document.getElementById('clientAddress').value
        },
        items: [],
        totals: {
          subtotal: document.getElementById('subtotal').textContent,
          tax: document.getElementById('taxTotal').textContent,
          shipping: document.getElementById('shippingCost').value,
          grandTotal: document.getElementById('grandTotal').textContent
        },
        payment: {
          method: document.getElementById('paymentMethod').value,
          date: document.getElementById('paymentDate').value,
          reference: document.getElementById('paymentReference').value
        },
        shipping: {
          address: document.getElementById('shippingAddress').value,
          method: document.getElementById('shippingMethod').value,
          cost: document.getElementById('shippingCost').value
        }
      };
      
      // Ø¬Ù…Ø¹ Ø§Ù„Ø¨Ù†ÙˆØ¯
      document.querySelectorAll("#itemsBody tr").forEach(row => {
        const product = row.cells[1].querySelector("input")?.value.trim();
        if (!product) return; // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø¨Ø¯ÙˆÙ† Ù…Ù†ØªØ¬
        
        invoiceData.items.push({
          product: product,
          quantity: row.cells[2].querySelector("input").value,
          price: row.cells[3].querySelector("input").value,
          tax: row.cells[4].querySelector("input").value,
          total: row.cells[5].textContent
        });
      });
      
      // Ø­ÙØ¸ ÙÙŠ localStorage
      const savedInvoices = JSON.parse(localStorage.getItem('savedInvoices') || '[]');
      savedInvoices.push({
        ...invoiceData,
        savedAt: new Date().toISOString()
      });
      localStorage.setItem('savedInvoices', JSON.stringify(savedInvoices));
      
      // ØªØ­Ù…ÙŠÙ„ ÙƒÙ…Ù„Ù JSON
      const dataStr = JSON.stringify(invoiceData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `ÙØ§ØªÙˆØ±Ø©-${invoiceData.invoiceNumber}.json`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
      
      showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }
    
    // ØªØºÙŠÙŠØ± Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØµÙØ­Ø©
    function changePageOrientation() {
      const orientation = document.getElementById('pageOrientation').value;
      const preview = document.getElementById('invoicePreview');
      if (orientation === 'landscape') {
        preview.classList.add('landscape');
      } else {
        preview.classList.remove('landscape');
      }
      updatePreview();
    }
    
    // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¥Ù„Ù‰ Ø¹Ø¯Ø© ØµÙØ­Ø§Øª (ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø¨Ø¯ÙˆÙ† Ù…Ù†ØªØ¬)
    function splitInvoiceIntoPages() {
      updatePreview();
      const itemsPerPage = parseInt(document.getElementById('itemsPerPage').value) || 15;
      // ØªØµÙÙŠØ© Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬ ÙÙ‚Ø·
      const validItems = Array.from(document.querySelectorAll("#itemsBody tr")).filter(row => {
        const product = row.cells[1].querySelector("input")?.value.trim();
        return product && product.length > 0;
      });
      const totalItems = validItems.length;
      const totalPages = Math.ceil(totalItems / itemsPerPage);
      
      if (totalPages <= 1) {
        return [validItems];
      }
      
      const pages = [];
      for (let i = 0; i < totalPages; i++) {
        const start = i * itemsPerPage;
        const end = Math.min(start + itemsPerPage, totalItems);
        pages.push(validItems.slice(start, end));
      }
      
      return pages;
    }
    
    // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙƒØµÙˆØ±Ø©
    function printInvoice() {
      updatePreview();
      showNotification('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©...', 'success');
      
      const preview = document.getElementById('invoicePreview');
      
      // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
      const printMessage = document.createElement('div');
      printMessage.className = 'print-only';
      printMessage.innerHTML = `
        <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
          <p>Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§</p>
          <p>Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª: ${document.getElementById('companyContact').textContent}</p>
        </div>
      `;
      preview.appendChild(printMessage);
      
      // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¥Ù„Ù‰ ØµÙˆØ±Ø© Ø«Ù… Ø·Ø¨Ø§Ø¹ØªÙ‡Ø§
      setTimeout(() => {
        html2canvas(preview, {
          scale: 2,
          useCORS: true,
          logging: false,
          backgroundColor: '#ffffff',
          width: preview.offsetWidth,
          height: preview.offsetHeight
        }).then(canvas => {
          // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
          const printWindow = window.open('', '_blank');
          const imgData = canvas.toDataURL('image/png');
          
          printWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
              <title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</title>
              <style>
                @page {
                  size: A4;
                  margin: 0;
                }
                body {
                  margin: 0;
                  padding: 0;
                }
                img {
                  width: 100%;
                  height: auto;
                  display: block;
                }
              </style>
            </head>
            <body>
              <img src="${imgData}" />
            </body>
            </html>
          `);
          
          printWindow.document.close();
          
          setTimeout(() => {
            printWindow.print();
            printWindow.close();
            
            // Ø¥Ø²Ø§Ù„Ø© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
            if (preview.contains(printMessage)) {
              preview.removeChild(printMessage);
            }
          }, 500);
        }).catch(error => {
          if (error) {
            console.error('Error printing:', error);
          }
          showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©', 'error');
          if (preview.contains(printMessage)) {
            preview.removeChild(printMessage);
          }
        });
      }, 500);
    }
    
    // ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ PDF
    function exportToPDF() {
      downloadAsPDF();
    }
    
    // ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙƒÙ…Ù„Ù PDF ÙƒØµÙˆØ±Ø©
    function downloadAsPDF() {
      updatePreview();
      showNotification('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± PDF...', 'success');
      
      const { jsPDF } = window.jspdf;
      const orientation = document.getElementById('pageOrientation').value;
      const itemsPerPage = parseInt(document.getElementById('itemsPerPage').value) || 15;
      const isLandscape = orientation === 'landscape';
      
      // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¥Ù„Ù‰ ØµÙØ­Ø§Øª
      const pages = splitInvoiceIntoPages();
      const totalPages = pages.length;
      
      if (totalPages === 0) {
        showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù†ÙˆØ¯ ÙÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©', 'error');
        return;
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ PDF Ø¬Ø¯ÙŠØ¯
      const pdf = new jsPDF({
        orientation: isLandscape ? 'landscape' : 'portrait',
        unit: 'mm',
        format: 'a4',
        compress: true
      });
      
      const pageWidth = isLandscape ? 297 : 210;
      const pageHeight = isLandscape ? 210 : 297;
      
      // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø© Ù„ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©
      function createPageImage(pageIndex, items) {
        return new Promise((resolve, reject) => {
          // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ù…Ø¤Ù‚Øª Ù„Ù„ØµÙØ­Ø©
          const tempDiv = document.createElement('div');
          tempDiv.style.position = 'absolute';
          tempDiv.style.left = '-9999px';
          tempDiv.style.width = isLandscape ? '297mm' : '210mm';
          tempDiv.style.background = 'white';
          tempDiv.style.padding = '30px';
          document.body.appendChild(tempDiv);
          
          // Ù†Ø³Ø® Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
          const preview = document.getElementById('invoicePreview');
          const clonedPreview = preview.cloneNode(true);
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ù†ÙˆØ¯ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
          const itemsBody = clonedPreview.querySelector('#previewItemsBody');
          if (itemsBody) {
            itemsBody.innerHTML = '';
            items.forEach((row, index) => {
              const rowNum = pageIndex * itemsPerPage + index + 1;
              const product = row.cells[1].querySelector("input")?.value || '-';
              const quantity = row.cells[2].querySelector("input").value || '0';
              const price = row.cells[3].querySelector("input").value || '0';
              const taxRate = row.cells[4].querySelector("input").value || '0';
              const total = row.cells[5].textContent || '0';
              
              const itemRow = document.createElement("tr");
              itemRow.innerHTML = `
                <td>${rowNum}</td>
                <td>${product}</td>
                <td>${quantity}</td>
                <td>${price}</td>
                <td>${taxRate}%</td>
                <td>${total}</td>
              `;
              itemsBody.appendChild(itemRow);
            });
          }
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª (ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© ÙÙ‚Ø·)
          if (pageIndex === totalPages - 1) {
            clonedPreview.querySelector('#previewSubtotal').textContent = document.getElementById('subtotal').textContent;
            clonedPreview.querySelector('#previewTaxTotal').textContent = document.getElementById('taxTotal').textContent;
            clonedPreview.querySelector('#previewShipping').textContent = document.getElementById('shippingCost').value || '0.00';
            clonedPreview.querySelector('#previewGrandTotal').textContent = document.getElementById('grandTotal').textContent;
          } else {
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª ÙÙŠ Ø§Ù„ØµÙØ­Ø§Øª ØºÙŠØ± Ø§Ù„Ø£Ø®ÙŠØ±Ø©
            const totalsSection = clonedPreview.querySelector('.invoice-totals-preview');
            if (totalsSection) {
              totalsSection.style.display = 'none';
            }
          }
          
          // Ø¥Ø¶Ø§ÙØ© Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø©
          const pageNumDiv = document.createElement('div');
          pageNumDiv.style.textAlign = 'center';
          pageNumDiv.style.marginTop = '20px';
          pageNumDiv.style.fontSize = '12px';
          pageNumDiv.textContent = `ØµÙØ­Ø© ${pageIndex + 1} Ù…Ù† ${totalPages}`;
          clonedPreview.appendChild(pageNumDiv);
          
          tempDiv.appendChild(clonedPreview);
          
          setTimeout(() => {
            html2canvas(clonedPreview, {
              scale: 2,
              useCORS: true,
              logging: false,
              backgroundColor: '#ffffff',
              width: clonedPreview.offsetWidth,
              height: clonedPreview.offsetHeight
            }).then(canvas => {
              const imgData = canvas.toDataURL('image/png');
              
              if (pageIndex > 0) {
                pdf.addPage();
              }
              
              // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ PDF
              pdf.addImage(imgData, 'PNG', 0, 0, pageWidth, pageHeight, undefined, 'FAST');
              
              document.body.removeChild(tempDiv);
              resolve();
            }).catch(error => {
              document.body.removeChild(tempDiv);
              reject(error);
            });
          }, 500);
        });
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª
      const promises = [];
      pages.forEach((items, index) => {
        promises.push(createPageImage(index, items));
      });
      
      Promise.all(promises).then(() => {
        // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù
        const invoiceNumber = document.getElementById('invoiceNumberDisplay').textContent;
        pdf.save(`ÙØ§ØªÙˆØ±Ø©-${invoiceNumber}.pdf`);
        showNotification('ØªÙ… ØªÙ†Ø²ÙŠÙ„ PDF Ø¨Ù†Ø¬Ø§Ø­', 'success');
      }).catch(error => {
        if (error) {
          console.error('Error creating PDF:', error);
        }
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ PDF', 'error');
      });
    }
    
    // Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙƒØµÙˆØ±Ø© (Ø¹Ø¯Ø© ØµÙØ­Ø§Øª ÙƒØµÙˆØ± Ù…Ù†ÙØµÙ„Ø©)
    function saveAsImage() {
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨Ù†ÙˆØ¯
      const itemsPerPage = parseInt(document.getElementById('itemsPerPage').value) || 15;
      const pages = splitInvoiceIntoPages();
      const totalPages = pages.length;
      
      if (totalPages === 0) {
        showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù†ÙˆØ¯ ÙÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©', 'error');
        return;
      }
      
      // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ø¹ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
      const loadingDiv = document.createElement('div');
      loadingDiv.className = 'image-saving';
      loadingDiv.innerHTML = `
        <div style="text-align: center;">
          <div style="font-size: 1.5rem; margin-bottom: 15px;">â³</div>
          <div style="font-size: 1.1rem; margin-bottom: 10px;">Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¥Ù„Ù‰ ØµÙˆØ±...</div>
          <div id="imageProgress" style="font-size: 0.9rem; color: #ccc;">0 / ${totalPages}</div>
        </div>
      `;
      document.body.appendChild(loadingDiv);
      
      updatePreview();
      
      const invoiceNumber = document.getElementById('invoiceNumberDisplay').textContent;
      const orientation = document.getElementById('pageOrientation').value;
      const isLandscape = orientation === 'landscape';
      let completedPages = 0;
      
      // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø© Ù„ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©
      function createPageImage(pageIndex, items) {
        return new Promise((resolve, reject) => {
          // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ù…Ø¤Ù‚Øª Ù„Ù„ØµÙØ­Ø©
          const tempDiv = document.createElement('div');
          tempDiv.style.position = 'absolute';
          tempDiv.style.left = '-9999px';
          tempDiv.style.width = isLandscape ? '297mm' : '210mm';
          tempDiv.style.minHeight = isLandscape ? '210mm' : '297mm';
          tempDiv.style.background = 'white';
          tempDiv.style.padding = '30px';
          tempDiv.style.boxSizing = 'border-box';
          document.body.appendChild(tempDiv);
          
          // Ù†Ø³Ø® Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
          const preview = document.getElementById('invoicePreview');
          const clonedPreview = preview.cloneNode(true);
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ù†ÙˆØ¯ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
          const itemsBody = clonedPreview.querySelector('#previewItemsBody');
          if (itemsBody) {
            itemsBody.innerHTML = '';
            items.forEach((row, index) => {
              const rowNum = pageIndex * itemsPerPage + index + 1;
              const product = row.cells[1].querySelector("input")?.value || '-';
              const quantity = row.cells[2].querySelector("input")?.value || '0';
              const price = row.cells[3].querySelector("input")?.value || '0';
              const taxRate = row.cells[4].querySelector("input")?.value || '0';
              const total = row.cells[5].textContent || '0';
              
              const itemRow = document.createElement("tr");
              itemRow.innerHTML = `
                <td>${rowNum}</td>
                <td>${product}</td>
                <td>${quantity}</td>
                <td>${price}</td>
                <td>${taxRate}%</td>
                <td>${total}</td>
              `;
              itemsBody.appendChild(itemRow);
            });
          }
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª (ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© ÙÙ‚Ø·)
          if (pageIndex === totalPages - 1) {
            const subtotalEl = clonedPreview.querySelector('#previewSubtotal');
            const taxEl = clonedPreview.querySelector('#previewTaxTotal');
            const shippingEl = clonedPreview.querySelector('#previewShipping');
            const grandTotalEl = clonedPreview.querySelector('#previewGrandTotal');
            
            if (subtotalEl) subtotalEl.textContent = document.getElementById('subtotal').textContent;
            if (taxEl) taxEl.textContent = document.getElementById('taxTotal').textContent;
            if (shippingEl) shippingEl.textContent = document.getElementById('shippingCost').value || '0.00';
            if (grandTotalEl) grandTotalEl.textContent = document.getElementById('grandTotal').textContent;
          } else {
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª ÙÙŠ Ø§Ù„ØµÙØ­Ø§Øª ØºÙŠØ± Ø§Ù„Ø£Ø®ÙŠØ±Ø©
            const totalsSection = clonedPreview.querySelector('.invoice-totals-preview');
            if (totalsSection) {
              totalsSection.style.display = 'none';
            }
          }
          
          // Ø¥Ø¶Ø§ÙØ© Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø©
          const pageNumDiv = document.createElement('div');
          pageNumDiv.style.textAlign = 'center';
          pageNumDiv.style.marginTop = '20px';
          pageNumDiv.style.fontSize = '12px';
          pageNumDiv.style.color = '#666';
          pageNumDiv.textContent = `ØµÙØ­Ø© ${pageIndex + 1} Ù…Ù† ${totalPages}`;
          clonedPreview.appendChild(pageNumDiv);
          
          tempDiv.appendChild(clonedPreview);
          
          // Ø§Ù†ØªØ¸Ø§Ø± Ù‚ØµÙŠØ± Ù„Ø¶Ù…Ø§Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±
          setTimeout(() => {
            html2canvas(clonedPreview, {
              scale: 2,
              useCORS: true,
              allowTaint: true,
              logging: false,
              backgroundColor: '#ffffff',
              width: clonedPreview.offsetWidth,
              height: clonedPreview.offsetHeight,
              windowWidth: clonedPreview.scrollWidth,
              windowHeight: clonedPreview.scrollHeight
            }).then(canvas => {
              try {
                // ØªØ­ÙˆÙŠÙ„ Canvas Ø¥Ù„Ù‰ ØµÙˆØ±Ø© PNG ØºÙŠØ± Ù…Ø¶ØºÙˆØ·Ø© (Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©)
                const image = canvas.toDataURL('image/png', 1.0);
                
                // ØªØ­ÙˆÙŠÙ„ base64 Ø¥Ù„Ù‰ Blob ØºÙŠØ± Ù…Ø¶ØºÙˆØ·
                const byteString = atob(image.split(',')[1]);
                const ab = new ArrayBuffer(byteString.length);
                const ia = new Uint8Array(ab);
                for (let i = 0; i < byteString.length; i++) {
                  ia[i] = byteString.charCodeAt(i);
                }
                const blob = new Blob([ab], { type: 'image/png' });
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· ØªØ­Ù…ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø± (ØºÙŠØ± Ù…Ø¶ØºÙˆØ·)
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `ÙØ§ØªÙˆØ±Ø©-${invoiceNumber}-ØµÙØ­Ø©-${pageIndex + 1}.png`;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                
                // ØªÙ†Ø¸ÙŠÙ
                setTimeout(() => {
                  document.body.removeChild(link);
                  URL.revokeObjectURL(url);
                }, 100);
                
                document.body.removeChild(tempDiv);
                completedPages++;
                
                // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
                const progressEl = document.getElementById('imageProgress');
                if (progressEl) {
                  progressEl.textContent = `${completedPages} / ${totalPages}`;
                }
                
                if (completedPages === totalPages) {
                  setTimeout(() => {
                    document.body.removeChild(loadingDiv);
                    showNotification(`âœ… ØªÙ… Ø­ÙØ¸ ${totalPages} ØµÙØ­Ø© ÙƒØµÙˆØ± PNG ØºÙŠØ± Ù…Ø¶ØºÙˆØ·Ø© Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                  }, 500);
                }
                
                resolve();
              } catch (error) {
                document.body.removeChild(tempDiv);
                reject(error);
              }
            }).catch(error => {
              if (error) {
                console.error('Error creating canvas:', error);
              }
              document.body.removeChild(tempDiv);
              reject(error);
            });
          }, 800); // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙˆÙ‚Øª Ù„Ø¶Ù…Ø§Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±
        });
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª Ø¨Ø´ÙƒÙ„ Ù…ØªØ³Ù„Ø³Ù„
      async function processPages() {
        for (let index = 0; index < pages.length; index++) {
          try {
            await createPageImage(index, pages[index]);
            // ØªØ£Ø®ÙŠØ± Ù‚ØµÙŠØ± Ø¨ÙŠÙ† Ø§Ù„ØµÙˆØ± Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù…ØªØµÙØ­
            if (index < pages.length - 1) {
              await new Promise(resolve => setTimeout(resolve, 300));
            }
          } catch (error) {
            if (error) {
              console.error(`Error saving page ${index + 1}:`, error);
            }
            if (index === pages.length - 1 || completedPages === 0) {
              if (document.body.contains(loadingDiv)) {
                document.body.removeChild(loadingDiv);
              }
              showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±', 'error');
            }
          }
        }
      }
      
      processPages();
    }
    
    // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function clearInvoice() {
      if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŸ')) {
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„
        document.getElementById('clientName').value = '';
        document.getElementById('clientEmail').value = '';
        document.getElementById('clientPhone').value = '';
        document.getElementById('clientAddress').value = '';
        document.getElementById('dealDetails').value = '';
        document.getElementById('paymentMethod').value = '';
        document.getElementById('paymentDate').value = '';
        document.getElementById('paymentReference').value = '';
        document.getElementById('shippingAddress').value = '';
        document.getElementById('shippingMethod').value = '';
        document.getElementById('shippingCost').value = '0';
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¬Ø¯ÙˆÙ„
        const itemsBody = document.getElementById('itemsBody');
        itemsBody.innerHTML = '';
        addRow(); // Ø¥Ø¶Ø§ÙØ© ØµÙ ÙØ§Ø±Øº
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('invoiceDate').value = today;
        
        const dueDate = new Date();
        dueDate.setDate(dueDate.getDate() + 30);
        document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
        updateTotals();
        
        showNotification('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©', 'success');
      }
    }
    
    // ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
    function fillSampleData() {
      document.getElementById('clientName').value = 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯';
      document.getElementById('clientEmail').value = 'ahmed@example.com';
      document.getElementById('clientPhone').value = '0551234567';
      document.getElementById('clientAddress').value = 'Ø§Ù„Ø±ÙŠØ§Ø¶ØŒ Ø­ÙŠ Ø§Ù„Ø¹Ù„ÙŠØ§ØŒ Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯';
      
      // ØªØ¹Ø¨Ø¦Ø© Ø¨Ø¹Ø¶ Ø§Ù„Ø¨Ù†ÙˆØ¯
      const itemsBody = document.getElementById('itemsBody');
      itemsBody.innerHTML = '';
      
      const sampleItems = [
        {id: 'PRD-001', desc: 'Ù„ÙˆØ­Ø© Ù…ÙØ§ØªÙŠØ­ Ù„Ø§Ø³Ù„ÙƒÙŠØ©', qty: 2, price: 120, tax: 15},
        {id: 'PRD-002', desc: 'Ù…Ø§ÙˆØ³ Ù„Ø§Ø³Ù„ÙƒÙŠ', qty: 2, price: 80, tax: 15},
        {id: 'PRD-003', desc: 'Ø´Ø§Ø´Ø© 24 Ø¨ÙˆØµØ©', qty: 1, price: 800, tax: 15}
      ];
      
      sampleItems.forEach((item, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${index + 1}</td>
          <td><input type="text" value="${item.id}" class="editable-cell"></td>
          <td><input type="text" value="${item.desc}" class="editable-cell"></td>
          <td><input type="number" class="quantity editable-cell" value="${item.qty}" min="1" oninput="calculateTotal(this)"></td>
          <td><input type="number" class="price editable-cell" value="${item.price}" min="0" step="0.01" oninput="calculateTotal(this)"></td>
          <td><input type="number" class="tax editable-cell" value="${item.tax}" min="0" max="100" step="0.01" oninput="calculateTotal(this)"></td>
          <td class="lineTotal">0.00</td>
          <td><button class="delete-btn" onclick="deleteRow(this)">Ã—</button></td>
        `;
        itemsBody.appendChild(row);
        calculateTotal(row.querySelector('.quantity'));
      });
      
      showNotification('ØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©', 'success');
    }
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    function showNotification(message, type) {
      const notification = document.getElementById("notification");
      notification.textContent = message;
      notification.className = `notification ${type} show`;
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ© Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    const companyNameEl = document.getElementById('companyName');
    const companyDescriptionEl = document.getElementById('companyDescription');
    const companyAddressEl = document.getElementById('companyAddress');
    const companyContactEl = document.getElementById('companyContact');
    
    if (companyNameEl) {
      companyNameEl.addEventListener('input', function() {
        const previewEl = document.getElementById('previewCompanyName');
        if (previewEl) previewEl.textContent = this.textContent;
      });
    }
    
    if (companyDescriptionEl) {
      companyDescriptionEl.addEventListener('input', function() {
        const previewEl = document.getElementById('previewCompanyDescription');
        if (previewEl) previewEl.textContent = this.textContent;
      });
    }
    
    if (companyAddressEl) {
      companyAddressEl.addEventListener('input', function() {
        const previewEl = document.getElementById('previewCompanyAddress');
        if (previewEl) previewEl.textContent = this.textContent;
      });
    }
    
    if (companyContactEl) {
      companyContactEl.addEventListener('input', function() {
        const previewEl = document.getElementById('previewCompanyContact');
        if (previewEl) previewEl.textContent = this.textContent;
      });
    }
    
    // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù…Ø¹ debounce)
    const invoiceDateEl = document.getElementById('invoiceDate');
    const dueDateEl = document.getElementById('dueDate');
    const clientNameEl = document.getElementById('clientName');
    const clientEmailEl = document.getElementById('clientEmail');
    const clientPhoneEl = document.getElementById('clientPhone');
    const clientAddressEl = document.getElementById('clientAddress');
    
    if (invoiceDateEl) invoiceDateEl.addEventListener('change', debouncedUpdatePreview);
    if (dueDateEl) dueDateEl.addEventListener('change', debouncedUpdatePreview);
    if (clientNameEl) clientNameEl.addEventListener('input', debouncedUpdatePreview);
    if (clientEmailEl) clientEmailEl.addEventListener('input', debouncedUpdatePreview);
    if (clientPhoneEl) clientPhoneEl.addEventListener('input', debouncedUpdatePreview);
    if (clientAddressEl) clientAddressEl.addEventListener('input', debouncedUpdatePreview);
    
    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ù†ÙˆØ¯
    const itemsPerPageEl = document.getElementById('itemsPerPage');
    if (itemsPerPageEl) {
      itemsPerPageEl.addEventListener('input', updatePageCount);
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØ©/Ø­Ø°Ù/ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯
    const itemsBody = document.getElementById('itemsBody');
    if (itemsBody) {
      const observer = new MutationObserver(() => {
        updatePageCount();
      });
      observer.observe(itemsBody, { childList: true, subtree: true });
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬ (Ù…Ø¹ debounce)
    document.addEventListener('input', function(e) {
      if (e.target.classList.contains('editable-cell') && e.target.closest('#itemsBody')) {
        updatePageCount();
        debouncedUpdateTotals();
      }
    });
    
    // ØªØ­Ø¯ÙŠØ« Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„
    function generateInvoiceNumber() {
      const year = new Date().getFullYear();
      const month = String(new Date().getMonth() + 1).padStart(2, '0');
      const day = String(new Date().getDate()).padStart(2, '0');
      const random = Math.floor(1000 + Math.random() * 9000);
      return `INV-${year}${month}${day}-${random}`;
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    const invoiceNumberDisplayEl = document.getElementById('invoiceNumberDisplay');
    const previewInvoiceNumberEl = document.getElementById('previewInvoiceNumber');
    
    if (invoiceNumberDisplayEl) {
      invoiceNumberDisplayEl.textContent = generateInvoiceNumber();
      if (previewInvoiceNumberEl) {
        previewInvoiceNumberEl.textContent = invoiceNumberDisplayEl.textContent;
      }
    }
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
    try {
      if (typeof loadDarkMode === 'function') {
        loadDarkMode();
      }
    } catch (e) {
      // Silent error
    }
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    try {
      if (typeof loadAutoSaveData === 'function') {
        loadAutoSaveData();
      }
    } catch (e) {
      // Silent error
    }
    
    // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
    try {
      if (typeof autoSaveData === 'function') {
        setInterval(autoSaveData, 30000);
        
        // Ø­ÙØ¸ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('beforeunload', function() {
          try {
            autoSaveData();
          } catch (e) {
            // Silent error
          }
        });
        
        // Ø­ÙØ¸ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        document.addEventListener('visibilitychange', function() {
          if (document.hidden) {
            try {
              autoSaveData();
            } catch (e) {
              // Silent error
            }
          }
        });
      }
    } catch (e) {
      // Silent error
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    setTimeout(() => {
      try {
        if (typeof updatePageCount === 'function') {
          updatePageCount();
        }
      } catch (e) {
        // Silent error
      }
    }, 500);
    
    // ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ØªÙØ§Ø¹Ù„ÙŠØ©
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initInteractiveFeatures);
    } else {
      initInteractiveFeatures();
    }
    
    function initInteractiveFeatures() {
      try {
        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        const elements = document.querySelectorAll('.tab-content, .section, .btn');
        elements.forEach((el, index) => {
          if (el) {
            el.style.opacity = '0';
            el.style.transform = 'translateY(20px)';
            setTimeout(() => {
              if (el) {
                el.style.transition = 'all 0.5s ease';
                el.style.opacity = '1';
                el.style.transform = 'translateY(0)';
              }
            }, index * 50);
          }
        });
        
        // ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
        const inputs = document.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
          if (input) {
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± focus Ù…Ø­Ø³Ù‘Ù†
            input.addEventListener('focus', function() {
              if (this.parentElement) {
                this.parentElement.classList.add('focused');
              }
            });
            
            input.addEventListener('blur', function() {
              if (this.parentElement) {
                this.parentElement.classList.remove('focused');
              }
            });
          }
        });
      } catch (e) {
        // Silent error
      }
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø³Ø±ÙŠØ¹
    function quickAddProduct() {
      const modal = document.getElementById('quickAddModal');
      const productInput = document.getElementById('quickProductName');
      if (modal) {
        modal.style.display = 'block';
        if (productInput) {
          setTimeout(() => productInput.focus(), 100);
        }
      }
    }
    
    function closeQuickAddModal() {
      const modal = document.getElementById('quickAddModal');
      if (modal) {
        modal.style.display = 'none';
      }
      // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
      const productInput = document.getElementById('quickProductName');
      const quantityInput = document.getElementById('quickQuantity');
      const priceInput = document.getElementById('quickPrice');
      const taxInput = document.getElementById('quickTax');
      
      if (productInput) productInput.value = '';
      if (quantityInput) quantityInput.value = '1';
      if (priceInput) priceInput.value = '0';
      if (taxInput) taxInput.value = '0';
    }
    
    function addQuickProduct() {
      const productInput = document.getElementById('quickProductName');
      const quantityInput = document.getElementById('quickQuantity');
      const priceInput = document.getElementById('quickPrice');
      const taxInput = document.getElementById('quickTax');
      
      if (!productInput || !quantityInput || !priceInput || !taxInput) {
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬', 'error');
        return;
      }
      
      const product = productInput.value.trim();
      const quantity = quantityInput.value;
      const price = priceInput.value;
      const tax = taxInput.value;
      
      if (!product) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬', 'error');
        productInput.focus();
        return;
      }
      
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬
      const table = document.getElementById("itemsBody");
      if (!table) {
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„', 'error');
        return;
      }
      
      const rowCount = table.rows.length + 1;
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${rowCount}</td>
        <td><input type="text" value="${escapeHtml(product)}" class="product editable-cell" required></td>
        <td><input type="number" class="quantity editable-cell" value="${quantity}" min="1" oninput="calculateTotal(this)"></td>
        <td><input type="number" class="price editable-cell" value="${price}" min="0" step="0.01" oninput="calculateTotal(this)"></td>
        <td><input type="number" class="tax editable-cell" value="${tax}" min="0" max="100" step="0.01" oninput="calculateTotal(this)"></td>
        <td class="lineTotal">0.00</td>
        <td><button class="delete-btn" onclick="deleteRow(this)">Ã—</button></td>
      `;
      table.appendChild(row);
      
      const quantityEl = row.querySelector('.quantity');
      if (quantityEl) {
        calculateTotal(quantityEl);
      }
      
      closeQuickAddModal();
      showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }
    
    // Ø¯Ø§Ù„Ø© Ù„ØªØ¬Ù†Ø¨ XSS
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function autoSaveData() {
      try {
        const invoiceData = {
          client: {
            name: document.getElementById('clientName').value,
            email: document.getElementById('clientEmail').value,
            phone: document.getElementById('clientPhone').value,
            address: document.getElementById('clientAddress').value
          },
          invoice: {
            date: document.getElementById('invoiceDate').value,
            dueDate: document.getElementById('dueDate').value,
            dealDetails: document.getElementById('dealDetails').value
          },
          items: [],
          payment: {
            method: document.getElementById('paymentMethod').value,
            date: document.getElementById('paymentDate').value,
            reference: document.getElementById('paymentReference').value
          },
          shipping: {
            address: document.getElementById('shippingAddress').value,
            method: document.getElementById('shippingMethod').value,
            cost: document.getElementById('shippingCost').value
          },
          company: {
            name: document.getElementById('companyName').textContent,
            description: document.getElementById('companyDescription').textContent,
            address: document.getElementById('companyAddress').textContent,
            contact: document.getElementById('companyContact').textContent
          },
          savedAt: new Date().toISOString()
        };
        
        // Ø¬Ù…Ø¹ Ø§Ù„Ø¨Ù†ÙˆØ¯
        document.querySelectorAll("#itemsBody tr").forEach(row => {
          const product = row.cells[1].querySelector("input")?.value.trim();
          if (product) {
            invoiceData.items.push({
              product: product,
              quantity: row.cells[2].querySelector("input").value,
              price: row.cells[3].querySelector("input").value,
              tax: row.cells[4].querySelector("input").value,
              total: row.cells[5].textContent
            });
          }
        });
        
        localStorage.setItem('autoSaveInvoice', JSON.stringify(invoiceData));
      } catch (e) {
        // Silent error handling - don't interrupt user experience
        if (e && typeof console !== 'undefined' && console.error) {
          console.error('Error auto-saving:', e);
        }
      }
    }
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    function loadAutoSaveData() {
      try {
        const saved = localStorage.getItem('autoSaveInvoice');
        if (saved) {
          const data = JSON.parse(saved);
          
          // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
          if (data.client) {
            document.getElementById('clientName').value = data.client.name || '';
            document.getElementById('clientEmail').value = data.client.email || '';
            document.getElementById('clientPhone').value = data.client.phone || '';
            document.getElementById('clientAddress').value = data.client.address || '';
          }
          
          // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©
          if (data.invoice) {
            if (data.invoice.date) document.getElementById('invoiceDate').value = data.invoice.date;
            if (data.invoice.dueDate) document.getElementById('dueDate').value = data.invoice.dueDate;
            if (data.invoice.dealDetails) document.getElementById('dealDetails').value = data.invoice.dealDetails;
          }
          
          // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯
          if (data.items && data.items.length > 0) {
            const itemsBody = document.getElementById('itemsBody');
            itemsBody.innerHTML = '';
            data.items.forEach((item, index) => {
              const row = document.createElement("tr");
              row.innerHTML = `
                <td>${index + 1}</td>
                <td><input type="text" value="${item.product}" class="product editable-cell" required></td>
                <td><input type="number" class="quantity editable-cell" value="${item.quantity}" min="1" oninput="calculateTotal(this)"></td>
                <td><input type="number" class="price editable-cell" value="${item.price}" min="0" step="0.01" oninput="calculateTotal(this)"></td>
                <td><input type="number" class="tax editable-cell" value="${item.tax}" min="0" max="100" step="0.01" oninput="calculateTotal(this)"></td>
                <td class="lineTotal">${item.total}</td>
                <td><button class="delete-btn" onclick="deleteRow(this)">Ã—</button></td>
              `;
              itemsBody.appendChild(row);
            });
            updateTotals();
          }
          
          // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹
          if (data.payment) {
            document.getElementById('paymentMethod').value = data.payment.method || '';
            document.getElementById('paymentDate').value = data.payment.date || '';
            document.getElementById('paymentReference').value = data.payment.reference || '';
          }
          
          // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø­Ù†
          if (data.shipping) {
            document.getElementById('shippingAddress').value = data.shipping.address || '';
            document.getElementById('shippingMethod').value = data.shipping.method || '';
            document.getElementById('shippingCost').value = data.shipping.cost || '0';
          }
          
          // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©
          if (data.company) {
            document.getElementById('companyName').textContent = data.company.name || 'Ø´Ø±ÙƒØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©';
            document.getElementById('companyDescription').textContent = data.company.description || 'ÙˆØµÙ Ø´Ø±ÙƒØªÙƒ ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§';
            document.getElementById('companyAddress').textContent = data.company.address || 'Ø¹Ù†ÙˆØ§Ù† Ø´Ø±ÙƒØªÙƒ';
            document.getElementById('companyContact').textContent = data.company.contact || 'Ù‡Ø§ØªÙ: 0123456789 | Ø§Ù„Ø¨Ø±ÙŠØ¯: info@company.com';
          }
          
          showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹', 'success');
        }
      } catch (e) {
        // Silent error handling
        if (e && typeof console !== 'undefined' && console.error) {
          console.error('Error loading auto-save data:', e);
        }
      }
    }
    
    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    const quickAddModalEl = document.getElementById('quickAddModal');
    if (quickAddModalEl) {
      quickAddModalEl.addEventListener('click', function(e) {
        if (e.target === this) {
          closeQuickAddModal();
        }
      });
    }
    
    // Ø¥Ø¶Ø§ÙØ© Enter Ù„Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
    const quickProductNameEl = document.getElementById('quickProductName');
    if (quickProductNameEl) {
      quickProductNameEl.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          addQuickProduct();
        }
      });
    }
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
    let uploadedLogo = null;
    
    // ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ - Debounce function
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }
    
    // ØªØ­Ø³ÙŠÙ† ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
    const debouncedUpdatePreview = debounce(updatePreview, 300);
    
    // ØªØ­Ø³ÙŠÙ† ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
    const debouncedUpdateTotals = debounce(updateTotals, 200);
    
    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      localStorage.setItem('darkMode', isDark);
      const toggleBtn = document.querySelector('.theme-toggle');
      toggleBtn.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
    }
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ Ù…Ù† localStorage
    function loadDarkMode() {
      const savedMode = localStorage.getItem('darkMode') === 'true';
      if (savedMode) {
        document.body.classList.add('dark-mode');
        document.querySelector('.theme-toggle').textContent = 'â˜€ï¸';
      }
    }
    
    // Ø±ÙØ¹ Ø§Ù„Ù„ÙˆØ¬Ùˆ
    function handleLogoUpload(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          uploadedLogo = e.target.result;
          document.getElementById('logoPreviewImg').src = uploadedLogo;
          document.getElementById('logoPreview').style.display = 'block';
          document.getElementById('removeLogoBtn').style.display = 'inline-block';
          updatePreview();
        };
        reader.readAsDataURL(file);
      }
    }
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù„ÙˆØ¬Ùˆ
    function removeLogo() {
      uploadedLogo = null;
      document.getElementById('logoUpload').value = '';
      document.getElementById('logoPreview').style.display = 'none';
      document.getElementById('removeLogoBtn').style.display = 'none';
      updatePreview();
    }
    
    // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ø¹ QR Code ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰
    function updateQRCode() {
      const showQRCB = document.getElementById('showQRCode');
      const qrCustomSection = document.getElementById('qrCustomSection');
      const qrTopContainer = document.getElementById('qrCodeTopContainer');
      const qrDiv = document.getElementById('qrcodeTop');
      const qrCustomLinkEl = document.getElementById('qrCustomLink');
      
      if (!showQRCB || !qrTopContainer || !qrDiv) return;
      
      const showQR = showQRCB.checked;
      const customLink = qrCustomLinkEl ? qrCustomLinkEl.value.trim() : '';
      
      // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„ØªØ®ØµÙŠØµ
      if (qrCustomSection) {
        qrCustomSection.style.display = showQR ? 'block' : 'none';
      }
      
      if (showQR) {
        qrTopContainer.style.display = 'flex';
        qrDiv.innerHTML = '';
        
        // ØªØ­Ø¯ÙŠØ¯ Ø¨ÙŠØ§Ù†Ø§Øª QR Code
        let qrData;
        if (customLink) {
          // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø®ØµØµ
          qrData = customLink;
        } else {
          // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©
          const invoiceNumberEl = document.getElementById('invoiceNumberDisplay');
          const invoiceDateEl = document.getElementById('invoiceDate');
          const clientNameEl = document.getElementById('clientName');
          const grandTotalEl = document.getElementById('grandTotal');
          
          const invoiceData = {
            number: invoiceNumberEl ? invoiceNumberEl.textContent : '',
            date: invoiceDateEl ? invoiceDateEl.value : '',
            client: clientNameEl ? clientNameEl.value : '',
            total: grandTotalEl ? grandTotalEl.textContent : ''
          };
          qrData = JSON.stringify(invoiceData);
        }
        
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… API Ù„Ø¥Ù†Ø´Ø§Ø¡ QR Code
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(qrData)}&ecc=M`;
        qrDiv.innerHTML = `<img src="${qrUrl}" alt="QR Code" style="max-width: 150px; height: auto;" loading="lazy">`;
      } else {
        qrTopContainer.style.display = 'none';
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
      updateLogoInPreview();
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
    function updateLogoInPreview() {
      const logoHeaderContainer = document.getElementById('companyLogoHeaderContainer');
      const logoPreview = document.getElementById('companyLogoPreview');
      
      if (!logoHeaderContainer || !logoPreview) return;
      
      if (uploadedLogo) {
        logoPreview.src = uploadedLogo;
        logoHeaderContainer.style.display = 'block';
      } else {
        logoHeaderContainer.style.display = 'none';
      }
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© updatePreview Ù„ØªØ´Ù…Ù„ QR Code ÙˆØ§Ù„Ù„ÙˆØ¬Ùˆ
    const originalUpdatePreview = updatePreview;
    updatePreview = function() {
      try {
        if (typeof originalUpdatePreview === 'function') {
          originalUpdatePreview();
        }
        updateQRCode();
        updateLogoInPreview();
      } catch (e) {
        // Silent error
      }
    };
    
    // ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø±Ø§Ø¨Ø· QR Ø§Ù„Ù…Ø®ØµØµ
    const qrCustomLinkEl = document.getElementById('qrCustomLink');
    if (qrCustomLinkEl) {
      qrCustomLinkEl.addEventListener('input', function() {
        const showQRCB = document.getElementById('showQRCode');
        if (showQRCB && showQRCB.checked) {
          updateQRCode();
        }
      });
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ ØªÙØ¹ÙŠÙ„/Ø¥Ù„ØºØ§Ø¡ ØªÙØ¹ÙŠÙ„ QR Code
    const showQRCB = document.getElementById('showQRCode');
    if (showQRCB) {
      showQRCB.addEventListener('change', function() {
        updateQRCode();
      });
    }
    
    // ØªØ­Ø³ÙŠÙ†Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©
    document.addEventListener('DOMContentLoaded', function() {
      // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
      const buttons = document.querySelectorAll('.btn, .quick-action-btn');
      buttons.forEach(btn => {
        btn.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-2px)';
        });
        btn.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0)';
        });
      });
      
      // ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
      const inputs = document.querySelectorAll('input, textarea, select');
      inputs.forEach(input => {
        input.addEventListener('focus', function() {
          this.style.borderColor = 'var(--secondary)';
          this.style.boxShadow = '0 0 0 3px rgba(52, 152, 219, 0.1)';
        });
        input.addEventListener('blur', function() {
          this.style.borderColor = '';
          this.style.boxShadow = '';
        });
      });
    });
    
    // Ø¹Ø±Ø¶ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
    function loadSavedInvoices() {
      const savedInvoices = JSON.parse(localStorage.getItem('savedInvoices') || '[]');
      const modal = document.getElementById('savedInvoicesModal');
      const list = document.getElementById('savedInvoicesList');
      
      if (savedInvoices.length === 0) {
        list.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ù…Ø­ÙÙˆØ¸Ø©</p>';
      } else {
        list.innerHTML = savedInvoices.reverse().map((invoice, index) => {
          const date = new Date(invoice.savedAt).toLocaleDateString('ar-SA');
          const originalIndex = savedInvoices.length - 1 - index;
          return `
            <div style="border: 1px solid #ddd; border-radius: 6px; padding: 15px; margin-bottom: 15px; background: #f9f9f9;">
              <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 10px;">
                <div style="flex: 1; min-width: 200px;">
                  <h3 style="color: var(--primary); margin-bottom: 8px; font-size: 1.1rem;">${invoice.invoiceNumber}</h3>
                  <p style="color: #666; margin: 4px 0;"><strong>Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${invoice.client.name || '-'}</p>
                  <p style="color: #666; margin: 4px 0;"><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${invoice.invoiceDate || '-'}</p>
                  <p style="color: #666; margin: 4px 0;"><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> ${invoice.totals.grandTotal} Ø±ÙŠØ§Ù„</p>
                  <p style="color: #999; font-size: 0.85rem; margin-top: 8px;">Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ: ${date}</p>
                </div>
                <div style="display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">
                  <button class="btn btn-primary" onclick="loadInvoice(${originalIndex})" style="padding: 8px 15px; font-size: 0.85rem; white-space: nowrap;">ğŸ“‚ ØªØ­Ù…ÙŠÙ„</button>
                  <button class="btn btn-danger" onclick="deleteSavedInvoice(${originalIndex})" style="padding: 8px 15px; font-size: 0.85rem; white-space: nowrap;">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                </div>
              </div>
            </div>
          `;
        }).join('');
      }
      
      modal.style.display = 'block';
    }
    
    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
    function closeSavedInvoicesModal() {
      document.getElementById('savedInvoicesModal').style.display = 'none';
    }
    
    // ØªØ­Ù…ÙŠÙ„ ÙØ§ØªÙˆØ±Ø© Ù…Ø­ÙÙˆØ¸Ø©
    function loadInvoice(index) {
      const savedInvoices = JSON.parse(localStorage.getItem('savedInvoices') || '[]');
      if (index >= 0 && index < savedInvoices.length) {
        const invoice = savedInvoices[index];
        
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©
        document.getElementById('companyName').textContent = invoice.company.name;
        document.getElementById('companyDescription').textContent = invoice.company.description;
        document.getElementById('companyAddress').textContent = invoice.company.address;
        document.getElementById('companyContact').textContent = invoice.company.contact;
        
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
        document.getElementById('clientName').value = invoice.client.name;
        document.getElementById('clientEmail').value = invoice.client.email;
        document.getElementById('clientPhone').value = invoice.client.phone;
        document.getElementById('clientAddress').value = invoice.client.address;
        
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        document.getElementById('invoiceDate').value = invoice.invoiceDate;
        document.getElementById('dueDate').value = invoice.dueDate;
        document.getElementById('invoiceNumberDisplay').textContent = invoice.invoiceNumber;
        document.getElementById('pageOrientation').value = invoice.pageOrientation || 'portrait';
        document.getElementById('itemsPerPage').value = invoice.itemsPerPage || 15;
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯
        const itemsBody = document.getElementById('itemsBody');
        itemsBody.innerHTML = '';
        invoice.items.forEach((item, idx) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${idx + 1}</td>
            <td><input type="text" value="${item.product}" class="product editable-cell" required></td>
            <td><input type="number" class="quantity editable-cell" value="${item.quantity}" min="1" oninput="calculateTotal(this)"></td>
            <td><input type="number" class="price editable-cell" value="${item.price}" min="0" step="0.01" oninput="calculateTotal(this)"></td>
            <td><input type="number" class="tax editable-cell" value="${item.tax}" min="0" max="100" step="0.01" oninput="calculateTotal(this)"></td>
            <td class="lineTotal">${item.total}</td>
            <td><button class="delete-btn" onclick="deleteRow(this)">Ã—</button></td>
          `;
          itemsBody.appendChild(row);
        });
        
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹
        document.getElementById('paymentMethod').value = invoice.payment.method;
        document.getElementById('paymentDate').value = invoice.payment.date;
        document.getElementById('paymentReference').value = invoice.payment.reference;
        
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø­Ù†
        document.getElementById('shippingAddress').value = invoice.shipping.address;
        document.getElementById('shippingMethod').value = invoice.shipping.method;
        document.getElementById('shippingCost').value = invoice.shipping.cost;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
        updateTotals();
        updatePreview();
        changePageOrientation();
        
        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        openTab('preview-tab', document.querySelector('.tab[onclick*="preview-tab"]'));
        
        closeSavedInvoicesModal();
        showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
      }
    }
    
    // Ø­Ø°Ù ÙØ§ØªÙˆØ±Ø© Ù…Ø­ÙÙˆØ¸Ø©
    function deleteSavedInvoice(index) {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŸ')) {
        const savedInvoices = JSON.parse(localStorage.getItem('savedInvoices') || '[]');
        savedInvoices.splice(index, 1);
        localStorage.setItem('savedInvoices', JSON.stringify(savedInvoices));
        loadSavedInvoices();
        showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
      }
    }
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    document.getElementById('savedInvoicesModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeSavedInvoicesModal();
      }
    });
  </script>
</body>
</html>
